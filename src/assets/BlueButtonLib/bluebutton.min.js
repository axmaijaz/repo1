/**
 * Minified by jsDelivr using Terser v5.10.0.
 * Original file: /npm/bluebutton@0.4.2/build/bluebutton.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.BlueButton=t()}(this,(function(){var e,t,a,r,n,i,s,o,c,l,m={parseData:function(t){if("<"===(t=e(t)).charAt(0))try{return m.XML.parse(t)}catch(e){console.log&&console.log("File looked like it might be XML but couldn't be parsed.")}try{return JSON.parse(t)}catch(e){throw console.error&&console.error("Error: Cannot parse this file. BB.js only accepts valid XML (for parsing) or JSON (for generation). If you are attempting to provide XML or JSON, please run your data through a validator to see if it is malformed.\n"),e}},stripWhitespace:e=function(e){return e?e.replace(/^\s+|\s+$/g,""):e},json:function(){var e=function(e){return e<10?"0"+e:e};return JSON.stringify(this,(function(t,a){var r=this[t];return a&&r instanceof Date&&!isNaN(r.getTime())?r._parsedWithTimeData||r.getHours()||r.getMinutes()||r.getSeconds()||r.getMilliseconds()?r.getUTCFullYear()+"-"+e(r.getUTCMonth()+1)+"-"+e(r.getUTCDate())+"T"+e(r.getUTCHours())+":"+e(r.getUTCMinutes())+":"+e(r.getUTCSeconds())+"Z":e(r.getMonth()+1)+"/"+e(r.getDate())+"/"+r.getFullYear():a}),2)},trim:t=function(e){var a;for(var r in e)e.hasOwnProperty(r)&&(null===(a=e[r])&&delete e[r],a instanceof Object&&(a=t(a)));return e}};m.Codes=(r={N:"annulled",C:"common law",D:"divorced",P:"domestic partner",I:"interlocutory",E:"legally separated",G:"living together",M:"married",O:"other",R:"registered domestic partner",A:"separated",S:"single",U:"unknown",B:"unmarried",T:"unreported",W:"widowed"},n={1001:"adventist",1002:"african religions",1003:"afro-caribbean religions",1004:"agnosticism",1005:"anglican",1006:"animism",1061:"assembly of god",1007:"atheism",1008:"babi & baha'i faiths",1009:"baptist",1010:"bon",1062:"brethren",1011:"cao dai",1012:"celticism",1013:"christian (non-catholic, non-specific)",1063:"christian scientist",1064:"church of christ",1065:"church of god",1014:"confucianism",1066:"congregational",1015:"cyberculture religions",1067:"disciples of christ",1016:"divination",1068:"eastern orthodox",1069:"episcopalian",1070:"evangelical covenant",1017:"fourth way",1018:"free daism",1071:"friends",1072:"full gospel",1019:"gnosis",1020:"hinduism",1021:"humanism",1022:"independent",1023:"islam",1024:"jainism",1025:"jehovah's witnesses",1026:"judaism",1027:"latter day saints",1028:"lutheran",1029:"mahayana",1030:"meditation",1031:"messianic judaism",1073:"methodist",1032:"mitraism",1074:"native american",1075:"nazarene",1033:"new age",1034:"non-roman catholic",1035:"occult",1036:"orthodox",1037:"paganism",1038:"pentecostal",1076:"presbyterian",1039:"process, the",1077:"protestant",1078:"protestant, no denomination",1079:"reformed",1040:"reformed/presbyterian",1041:"roman catholic church",1080:"salvation army",1042:"satanism",1043:"scientology",1044:"shamanism",1045:"shiite (islam)",1046:"shinto",1047:"sikism",1048:"spiritualism",1049:"sunni (islam)",1050:"taoism",1051:"theravada",1081:"unitarian universalist",1052:"unitarian-universalism",1082:"united church of christ",1053:"universal life church",1054:"vajrayana (tibetan)",1055:"veda",1056:"voodoo",1057:"wicca",1058:"yaohushua",1059:"zen buddhism",1060:"zoroastrianism"},i={"2028-9":"asian","2054-5":"black or african american","2135-2":"hispanic or latino","2076-8":"native","2186-5":"not hispanic or latino","2131-1":"other","2106-3":"white"},s={ACC:"accident site",ACHFID:"accreditation location identifier",ACTMIL:"active duty military",ALL:"allergy clinic",AMB:"ambulance",AMPUT:"amputee clinic",ANTIBIOT:"antibiotic",ASSIST:"assistive non-person living subject",AUNT:"aunt",B:"blind",BF:"beef",BILL:"billing contact",BIOTH:"biotherapeutic non-person living subject",BL:"broiler",BMTC:"bone marrow transplant clinic",BMTU:"bone marrow transplant unit",BR:"breeder",BREAST:"breast clinic",BRO:"brother",BROINLAW:"brother-in-law",C:"calibrator",CANC:"child and adolescent neurology clinic",CAPC:"child and adolescent psychiatry clinic",CARD:"ambulatory health care facilities; clinic/center; rehabilitation: cardiac facilities",CAS:"asylum seeker",CASM:"single minor asylum seeker",CATH:"cardiac catheterization lab",CCO:"clinical companion",CCU:"coronary care unit",CHEST:"chest unit",CHILD:"child",CHLDADOPT:"adopted child",CHLDFOST:"foster child",CHLDINLAW:"child in-law",CHR:"chronic care facility",CLAIM:"claimant",CN:"national",CNRP:"non-country member without residence permit",CNRPM:"non-country member minor without residence permit",CO:"companion",COAG:"coagulation clinic",COCBEN:"continuity of coverage beneficiary",COMM:"community location",COMMUNITYLABORATORY:"community laboratory",COUSN:"cousin",CPCA:"permit card applicant",CRIMEVIC:"crime victim",CRP:"non-country member with residence permit",CRPM:"non-country member minor with residence permit",CRS:"colon and rectal surgery clinic",CSC:"community service center",CVDX:"cardiovascular diagnostics or therapeutics unit",DA:"dairy",DADDR:"delivery address",DAU:"natural daughter",DAUADOPT:"adopted daughter",DAUC:"daughter",DAUFOST:"foster daughter",DAUINLAW:"daughter in-law",DC:"therapeutic class",DEBR:"debridement",DERM:"dermatology clinic",DIFFABL:"differently abled",DOMPART:"domestic partner",DPOWATT:"durable power of attorney",DR:"draft",DU:"dual",DX:"diagnostics or therapeutics unit",E:"electronic qc",ECHO:"echocardiography lab",ECON:"emergency contact",ENDO:"endocrinology clinic",ENDOS:"endoscopy lab",ENROLBKR:"enrollment broker",ENT:"otorhinolaryngology clinic",EPIL:"epilepsy unit",ER:"emergency room",ERL:"enrollment",ETU:"emergency trauma unit",EXCEST:"executor of estate",EXT:"extended family member",F:"filler proficiency",FAMDEP:"family dependent",FAMMEMB:"family member",FI:"fiber",FMC:"family medicine clinic",FRND:"unrelated friend",FSTUD:"full-time student",FTH:"father",FTHINLAW:"father-in-law",FULLINS:"fully insured coverage sponsor",G:"group",GACH:"hospitals; general acute care hospital",GD:"generic drug",GDF:"generic drug form",GDS:"generic drug strength",GDSF:"generic drug strength form",GGRFTH:"great grandfather",GGRMTH:"great grandmother",GGRPRN:"great grandparent",GI:"gastroenterology clinic",GIDX:"gastroenterology diagnostics or therapeutics lab",GIM:"general internal medicine clinic",GRFTH:"grandfather",GRMTH:"grandmother",GRNDCHILD:"grandchild",GRNDDAU:"granddaughter",GRNDSON:"grandson",GRPRN:"grandparent",GT:"guarantor",GUADLTM:"guardian ad lidem",GUARD:"guardian",GYN:"gynecology clinic",HAND:"hand clinic",HANDIC:"handicapped dependent",HBRO:"half-brother",HD:"hemodialysis unit",HEM:"hematology clinic",HLAB:"hospital laboratory",HOMEHEALTH:"home health",HOSP:"hospital",HPOWATT:"healthcare power of attorney",HRAD:"radiology unit",HSIB:"half-sibling",HSIS:"half-sister",HTN:"hypertension clinic",HU:"hospital unit",HUSB:"husband",HUSCS:"specimen collection site",ICU:"intensive care unit",IEC:"impairment evaluation center",INDIG:"member of an indigenous people",INFD:"infectious disease clinic",INJ:"injured plaintiff",INJWKR:"injured worker",INLAB:"inpatient laboratory",INPHARM:"inpatient pharmacy",INV:"infertility clinic",JURID:"jurisdiction location identifier",L:"pool",LABORATORY:"laboratory",LOCHFID:"local location identifier",LY:"layer",LYMPH:"lympedema clinic",MAUNT:"maternalaunt",MBL:"medical laboratory",MCOUSN:"maternalcousin",MGDSF:"manufactured drug strength form",MGEN:"medical genetics clinic",MGGRFTH:"maternalgreatgrandfather",MGGRMTH:"maternalgreatgrandmother",MGGRPRN:"maternalgreatgrandparent",MGRFTH:"maternalgrandfather",MGRMTH:"maternalgrandmother",MGRPRN:"maternalgrandparent",MHSP:"military hospital",MIL:"military",MOBL:"mobile unit",MT:"meat",MTH:"mother",MTHINLAW:"mother-in-law",MU:"multiplier",MUNCLE:"maternaluncle",NBOR:"neighbor",NBRO:"natural brother",NCCF:"nursing or custodial care facility",NCCS:"neurology critical care and stroke unit",NCHILD:"natural child",NEPH:"nephrology clinic",NEPHEW:"nephew",NEUR:"neurology clinic",NFTH:"natural father",NFTHF:"natural father of fetus",NIECE:"niece",NIENEPH:"niece/nephew",NMTH:"natural mother",NOK:"next of kin",NPRN:"natural parent",NS:"neurosurgery unit",NSIB:"natural sibling",NSIS:"natural sister",O:"operator proficiency",OB:"obstetrics clinic",OF:"outpatient facility",OMS:"oral and maxillofacial surgery clinic",ONCL:"medical oncology clinic",OPH:"opthalmology clinic",OPTC:"optometry clinic",ORG:"organizational contact",ORTHO:"orthopedics clinic",OUTLAB:"outpatient laboratory",OUTPHARM:"outpatient pharmacy",P:"patient",PAINCL:"pain clinic",PATHOLOGIST:"pathologist",PAUNT:"paternalaunt",PAYOR:"payor contact",PC:"primary care clinic",PCOUSN:"paternalcousin",PEDC:"pediatrics clinic",PEDCARD:"pediatric cardiology clinic",PEDE:"pediatric endocrinology clinic",PEDGI:"pediatric gastroenterology clinic",PEDHEM:"pediatric hematology clinic",PEDHO:"pediatric oncology clinic",PEDICU:"pediatric intensive care unit",PEDID:"pediatric infectious disease clinic",PEDNEPH:"pediatric nephrology clinic",PEDNICU:"pediatric neonatal intensive care unit",PEDRHEUM:"pediatric rheumatology clinic",PEDU:"pediatric unit",PGGRFTH:"paternalgreatgrandfather",PGGRMTH:"paternalgreatgrandmother",PGGRPRN:"paternalgreatgrandparent",PGRFTH:"paternalgrandfather",PGRMTH:"paternalgrandmother",PGRPRN:"paternalgrandparent",PH:"policy holder",PHARM:"pharmacy",PHLEBOTOMIST:"phlebotomist",PHU:"psychiatric hospital unit",PL:"pleasure",PLS:"plastic surgery clinic",POD:"podiatry clinic",POWATT:"power of attorney",PRC:"pain rehabilitation center",PREV:"preventive medicine clinic",PRN:"parent",PRNINLAW:"parent in-law",PROCTO:"proctology clinic",PROFF:"provider's office",PROG:"program eligible",PROS:"prosthodontics clinic",PSI:"psychology clinic",PSTUD:"part-time student",PSY:"psychiatry clinic",PSYCHF:"psychiatric care facility",PT:"patient",PTRES:"patient's residence",PUNCLE:"paternaluncle",Q:"quality control",R:"replicate",RADDX:"radiology diagnostics or therapeutics unit",RADO:"radiation oncology unit",RC:"racing",RESPRSN:"responsible party",RETIREE:"retiree",RETMIL:"retired military",RH:"rehabilitation hospital",RHAT:"addiction treatment center",RHEUM:"rheumatology clinic",RHII:"intellectual impairment center",RHMAD:"parents with adjustment difficulties center",RHPI:"physical impairment center",RHPIH:"physical impairment - hearing center",RHPIMS:"physical impairment - motor skills center",RHPIVS:"physical impairment - visual skills center",RHU:"rehabilitation hospital unit",RHYAD:"youths with adjustment difficulties center",RNEU:"neuroradiology unit",ROOM:"roommate",RTF:"residential treatment facility",SCHOOL:"school",SCN:"screening",SEE:"seeing",SELF:"self",SELFINS:"self insured coverage sponsor",SH:"show",SIB:"sibling",SIBINLAW:"sibling in-law",SIGOTHR:"significant other",SIS:"sister",SISINLAW:"sister-in-law",SLEEP:"sleep disorders unit",SNF:"skilled nursing facility",SNIFF:"sniffing",SON:"natural son",SONADOPT:"adopted son",SONC:"son",SONFOST:"foster son",SONINLAW:"son in-law",SPMED:"sports medicine clinic",SPON:"sponsored dependent",SPOWATT:"special power of attorney",SPS:"spouse",STPBRO:"stepbrother",STPCHLD:"step child",STPDAU:"stepdaughter",STPFTH:"stepfather",STPMTH:"stepmother",STPPRN:"step parent",STPSIB:"step sibling",STPSIS:"stepsister",STPSON:"stepson",STUD:"student",SU:"surgery clinic",SUBJECT:"self",SURF:"substance use rehabilitation facility",THIRDPARTY:"third party",TPA:"third party administrator",TR:"transplant clinic",TRAVEL:"travel and geographic medicine clinic",TRB:"tribal member",UMO:"utilization management organization",UNCLE:"uncle",UPC:"underage protection center",URO:"urology clinic",V:"verifying",VET:"veteran",VL:"veal",WARD:"ward",WIFE:"wife",WL:"wool",WND:"wound clinic",WO:"working",WORK:"work site"},o={55561003:"active",73425007:"inactive",413322009:"resolved"},l=function(e){return function(t){return t&&function(e){for(var t={},a=Object.keys(e),r=0,n=a.length;r<n;r++)t[e[a[r]]]=a[r];return t}(e)[t=t.toLowerCase()]||null}},{gender:(c=function(e){return function(t){return e[t]||null}})(a={F:"female",M:"male",UN:"undifferentiated"}),reverseGender:l(a),maritalStatus:c(r),reverseMaritalStatus:l(r),religion:c(n),reverseReligion:l(n),raceEthnicity:c(i),reverseRaceEthnicity:l(i),role:c(s),reverseRole:l(s),problemStatus:c(o),reverseProblemStatus:l(o)}),m.XML=function(){var e,t=function(e){function t(e){return{el:e,template:r,content:n,tag:i,immediateChildTag:s,elsByTag:o,attr:l,boolAttr:d,val:u,isEmpty:g}}if(e.length){for(var a=[],c=0;c<e.length;c++)a.push(t(e[c]));return a}return t(e)},a=function(e,t,a,r){e=e.getElementsByTagName(t);for(var n=0;n<e.length;n++)if(e[n].getAttribute(a)===r)return e[n]},r=function(e){var r=a(this.el,"templateId","root",e);return r?t(r.parentNode):p()},n=function(e){var r=a(this.el,"content","ID",e);return r||(r=a(this.el,"td","ID",e)),r||(r=a(this.el,"caption","ID",e)||a(this.el,"paragraph","ID",e)||a(this.el,"tr","ID",e)||a(this.el,"item","ID",e)),r?t(r):p()},i=function(e){var a=this.el.getElementsByTagName(e)[0];return a?t(a):p()},s=function(e){var a=this.el.getElementsByTagName(e);if(!a)return null;for(var r=0;r<a.length;r++)if(a[r].parentNode===this.el)return t(a[r]);return p()},o=function(e){return t(this.el.getElementsByTagName(e))},c=function(e){return e?e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&apos;/g,"'"):e},l=function(e){if(!this.el)return null;var t=this.el.getAttribute(e);return t?c(t):null},d=function(e){var t=this.attr(e);return"true"===t||"1"===t},u=function(){if(!this.el)return null;if(!this.el.childNodes||!this.el.childNodes.length)return null;var e=this.el.textContent;if(!m.stripWhitespace(e)){var a;if(1===this.el.childNodes.length&&"reference"===this.el.childNodes[0].tagName)a=this.el.childNodes[0].getAttribute("value");else{if(3!==this.el.childNodes.length||"reference"!==this.el.childNodes[1].tagName)return c(e);a=this.el.childNodes[1].getAttribute("value")}if(a&&"#"===a[0])return a=a.slice(1),t(this.el.ownerDocument).content(a).val()}return c(e)},p=function(){var e=h.createElement("empty");return t(e)},g=function(){return"empty"===this.el.tagName.toLowerCase()},y=!1,h=this.document;return"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(y=!0,e=require("xmldom"),h=(new e.DOMImplementation).createDocument()),{parse:function(a){if(!a||"string"!=typeof a)return console.log("BB Error: XML data is not a string"),null;var r;if(y)r=(new e.DOMParser).parseFromString(a,"text/xml");else if(window.DOMParser)r=(new DOMParser).parseFromString(a,"text/xml");else try{(r=new ActiveXObject("Microsoft.XMLDOM")).async="false",r.loadXML(a)}catch(e){console.log("BB ActiveX Exception: Could not parse XML")}return r&&r.documentElement&&!r.getElementsByTagName("parsererror").length?t(r):(console.log("BB Error: Could not parse XML"),null)}}}();var d,u=function(){var e=function(e){if(!e||"string"!=typeof e)return null;if(4===e.length)return new Date(e,0,1);var n,i,s,o,c=e.substr(0,4),l=parseInt(e.substr(4,2),10)-1,m=e.substr(6,2)||1;if(e.length>=12){var d=e.substr(8,2),u=e.substr(10,2),p=e.substr(12,2);if(e.length>14){var g=(n=e.substr(14),i=(n=n||"").match(a)||[],s=((i[i.length-1]||[])+"").match(t)||["-",0,0],o=60*s[1]+r(s[2]),"+"===s[0]?o:-o);u=r(u)-g}var y=new Date(Date.UTC(c,l,m,d,u,p));return y._parsedWithTimeData=!0,y}return new Date(c,l,m)},t=/([\+\-]|\d\d)/gi,a=/Z|[\+\-]\d\d:?\d\d/gi;function r(e){var t=+e,a=0;return 0!==t&&isFinite(t)&&(a=t>=0?Math.floor(t):Math.ceil(t)),a}return"undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(module.exports={parseDate:e}),{detect:function(e){return e.template?e.template("2.16.840.1.113883.3.88.11.32.1").isEmpty()?e.template("2.16.840.1.113883.10.20.22.1.1").isEmpty()?void 0:"ccda":"c32":"json"},entries:function(){var e=this.elsByTag("entry");return e.each=function(e){for(var t=0;t<this.length;t++)e(this[t])},e},parseDate:e,parseName:function(e){for(var t=e.tag("prefix").val(),a=e.elsByTag("given"),r=[],n=0;n<a.length;n++){var i=a[n].val();i&&r.push(i)}return{prefix:t,given:r,family:e.tag("family").val()}},parseAddress:function(e){for(var t=e.elsByTag("streetAddressLine"),a=[],r=0;r<t.length;r++){var n=t[r].val();n&&a.push(n)}return{street:a,city:e.tag("city").val(),state:e.tag("state").val(),zip:e.tag("postalCode").val(),country:e.tag("country").val()}}}}();u.C32={process:function(e){return e.section=d,e},section:d=function(e){var t,a=u.entries;switch(e){case"document":case"demographics":return this.template("2.16.840.1.113883.3.88.11.32.1");case"allergies":return(t=this.template("2.16.840.1.113883.3.88.11.83.102")).isEmpty()&&(t=this.template("2.16.840.1.113883.10.20.1.2")),t.entries=a,t;case"encounters":return(t=this.template("2.16.840.1.113883.3.88.11.83.127")).isEmpty()&&(t=this.template("2.16.840.1.113883.10.20.1.3")),t.entries=a,t;case"immunizations":return(t=this.template("2.16.840.1.113883.3.88.11.83.117")).isEmpty()&&(t=this.template("2.16.840.1.113883.10.20.1.6")),t.entries=a,t;case"results":return(t=this.template("2.16.840.1.113883.3.88.11.83.122")).entries=a,t;case"medications":return(t=this.template("2.16.840.1.113883.3.88.11.83.112")).isEmpty()&&(t=this.template("2.16.840.1.113883.10.20.1.8")),t.entries=a,t;case"problems":return(t=this.template("2.16.840.1.113883.3.88.11.83.103")).isEmpty()&&(t=this.template("2.16.840.1.113883.10.20.1.11")),t.entries=a,t;case"procedures":return(t=this.template("2.16.840.1.113883.3.88.11.83.108")).isEmpty()&&(t=this.template("2.16.840.1.113883.10.20.1.12")),t.entries=a,t;case"vitals":return(t=this.template("2.16.840.1.113883.3.88.11.83.119")).isEmpty()&&(t=this.template("2.16.840.1.113883.10.20.1.16")),t.entries=a,t}return null}},u.CCDA=function(){var e=function(e){var t,a=u.entries;switch(e){case"document":case"demographics":return this.template("2.16.840.1.113883.10.20.22.1.1");case"allergies":return(t=this.template("2.16.840.1.113883.10.20.22.2.6.1")).entries=a,t;case"care_plan":return(t=this.template("2.16.840.1.113883.10.20.22.2.10")).entries=a,t;case"chief_complaint":return(t=this.template("2.16.840.1.113883.10.20.22.2.13")).isEmpty()&&(t=this.template("1.3.6.1.4.1.19376.1.5.3.1.1.13.2.1")),t;case"encounters":return(t=this.template("2.16.840.1.113883.10.20.22.2.22")).isEmpty()&&(t=this.template("2.16.840.1.113883.10.20.22.2.22.1")),t.entries=a,t;case"functional_statuses":return(t=this.template("2.16.840.1.113883.10.20.22.2.14")).entries=a,t;case"immunizations":return(t=this.template("2.16.840.1.113883.10.20.22.2.2.1")).isEmpty()&&(t=this.template("2.16.840.1.113883.10.20.22.2.2")),t.entries=a,t;case"instructions":return(t=this.template("2.16.840.1.113883.10.20.22.2.45")).entries=a,t;case"results":return(t=this.template("2.16.840.1.113883.10.20.22.2.3.1")).isEmpty()&&(t=this.template("2.16.840.1.113883.10.20.22.2.3")),t.entries=a,t;case"medications":return(t=this.template("2.16.840.1.113883.10.20.22.2.1.1")).isEmpty()&&(t=this.template("2.16.840.1.113883.10.20.22.2.1")),t.entries=a,t;case"problems":return(t=this.template("2.16.840.1.113883.10.20.22.2.5.1")).isEmpty()&&(t=this.template("2.16.840.1.113883.10.20.22.2.5")),t.entries=a,t;case"procedures":return(t=this.template("2.16.840.1.113883.10.20.22.2.7.1")).isEmpty()&&(t=this.template("2.16.840.1.113883.10.20.22.2.7")),t.entries=a,t;case"social_history":return(t=this.template("2.16.840.1.113883.10.20.22.2.17")).entries=a,t;case"vitals":return(t=this.template("2.16.840.1.113883.10.20.22.2.4.1")).isEmpty()&&(t=this.template("2.16.840.1.113883.10.20.22.2.4")),t.entries=a,t}return null};return{process:function(t){return t.section=e,t},section:e}}();var p=function(){if("undefined"!=typeof exports&&"undefined"!=typeof module&&module.exports&&(ejs=require("ejs")),"undefined"!=typeof ejs){var e=function(e){return e<10?"0"+e:String(e)};ejs.filters.hl7Date=function(t){try{if(null==t)return'nullFlavor="UNK"';var a=new Date(t);if(isNaN(a.getTime()))return t;return a.getHours()||a.getMinutes()||a.getSeconds()?'value="'+(a.getUTCFullYear()+e(a.getUTCMonth()+1)+e(a.getUTCDate()))+(e(a.getUTCHours())+e(a.getUTCMinutes())+e(a.getUTCSeconds())+"+0000")+'"':'value="'+(String(a.getFullYear())+e(a.getMonth()+1)+e(a.getDate()))+'"'}catch(e){return t}};var t=function(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")};ejs.filters.hl7Code=function(e){if(!e)return"";var a="",r=e.name||"";return e.name&&(a+='displayName="'+t(r)+'"'),e.code?(a+=' code="'+e.code+'"',e.code_system&&(a+=' codeSystem="'+t(e.code_system)+'"'),e.code_system_name&&(a+=' codeSystemName="'+t(e.code_system_name)+'"')):a+=' nullFlavor="UNK"',e.name||e.code?a:'nullFlavor="UNK"'},ejs.filters.emptyStringIfFalsy=function(e){return e||""},ejs.helpers||(ejs.helpers={}),ejs.helpers.simpleTag=function(e,t){return t?"<"+e+">"+t+"</"+e+">":"<"+e+' nullFlavor="UNK" />'},ejs.helpers.addressTags=function(e){if(!e)return'<streetAddressLine nullFlavor="NI" />\n<city nullFlavor="NI" />\n<state nullFlavor="NI" />\n<postalCode nullFlavor="NI" />\n<country nullFlavor="NI" />\n';var t="";if(e.street.length)for(var a=0;a<e.street.length;a++)t+=ejs.helpers.simpleTag("streetAddressLine",e.street[a])+"\n";else t+=ejs.helpers.simpleTag("streetAddressLine",null)+"\n";return t+=ejs.helpers.simpleTag("city",e.city)+"\n",t+=ejs.helpers.simpleTag("state",e.state)+"\n",t+=ejs.helpers.simpleTag("postalCode",e.zip)+"\n",t+=ejs.helpers.simpleTag("country",e.country)+"\n"},ejs.helpers.nameTags=function(e){if(!e)return'<given nullFlavor="NI" />\n<family nullFlavor="NI" />\n';var t="";if(e.prefix&&(t+=ejs.helpers.simpleTag("prefix",e.prefix)+"\n"),e.given.length)for(var a=0;a<e.given.length;a++)t+=ejs.helpers.simpleTag("given",e.given[a])+"\n";else t+=ejs.helpers.simpleTag("given",null)+"\n";return t+=ejs.helpers.simpleTag("family",e.family)+"\n",e.suffix&&(t+=ejs.helpers.simpleTag("suffix",e.suffix)+"\n"),t}}return{method:function(){}}}();p.C32={run:function(e,t,a){return console.log("C32 generation is not implemented yet"),null}},p.CCDA={run:function(e,t,a){if(!ejs)return console.log("The BB.js Generator (JSON->XML) requires the EJS template package. Install it in Node or include it before this package in the browser."),null;if(!t)return console.log("Please provide a template EJS file for the Generator to use. Load it via fs.readFileSync in Node or XHR in the browser."),null;var r=a?new Date("2000-01-01T12:00:00Z"):new Date;return ejs.render(t,{filename:"ccda.xml",bb:e,now:r,tagHelpers:ejs.helpers,codes:m.Codes})}};var g={method:function(){}};g.C32={run:function(e){var t={};return t.document=g.C32.document(e),t.allergies=g.C32.allergies(e),t.demographics=g.C32.demographics(e),t.encounters=g.C32.encounters(e),t.immunizations=g.C32.immunizations(e).administered,t.immunization_declines=g.C32.immunizations(e).declined,t.results=g.C32.results(e),t.medications=g.C32.medications(e),t.problems=g.C32.problems(e),t.procedures=g.C32.procedures(e),t.vitals=g.C32.vitals(e),t.json=m.json,t.document.json=m.json,t.allergies.json=m.json,t.demographics.json=m.json,t.encounters.json=m.json,t.immunizations.json=m.json,t.immunization_declines.json=m.json,t.results.json=m.json,t.medications.json=m.json,t.problems.json=m.json,t.procedures.json=m.json,t.vitals.json=m.json,t.smoking_status={date:null,name:null,code:null,code_system:null,code_system_name:null},t.smoking_status.json=m.json,t.chief_complaint={text:null},t.chief_complaint.json=m.json,t.care_plan=[],t.care_plan.json=m.json,t.instructions=[],t.instructions.json=m.json,t.functional_statuses=[],t.functional_statuses.json=m.json,t}},g.C32.document=function(e){var t,a=u.parseDate,r=u.parseName,n=u.parseAddress,i=e.section("document"),s=a(i.tag("effectiveTime").attr("value")),o=m.stripWhitespace(i.tag("title").val()),c=i.tag("author"),l=r(t=c.tag("assignedPerson").tag("name"));l.prefix||l.given.length||l.family||(l.family=t.val());for(var d=n(t=c.tag("addr")),p=(t=c.tag("telecom")).attr("value"),g=[],y=i.tag("documentationOf").elsByTag("performer"),h=0;h<y.length;h++){var v=r(t=y[h].tag("assignedPerson").tag("name")),f=y[h].tag("telecom").attr("value"),N=n(t.tag("addr"));g.push({name:v,phone:{work:f},address:N})}t=i.tag("encompassingEncounter");var C=m.stripWhitespace(t.tag("name").val()),_=n(t.tag("addr")),S=null;return(t=t.tag("effectiveTime")).isEmpty()||(S=a(t.attr("value"))),{date:s,title:o,author:{name:l,address:d,phone:{work:p}},documentation_of:g,location:{name:C,address:_,encounter_date:S}}},g.C32.allergies=function(e){var t,a=u.parseDate,r=(u.parseName,u.parseAddress,[]);return e.section("allergies").entries().each((function(e){t=e.tag("effectiveTime");var n=a(t.tag("low").attr("value")),i=a(t.tag("high").attr("value")),s=(t=e.template("2.16.840.1.113883.3.88.11.83.6").tag("code")).attr("displayName"),o=t.attr("code"),c=t.attr("codeSystem"),l=t.attr("codeSystemName"),d=(t=e.template("2.16.840.1.113883.3.88.11.83.6").tag("value")).attr("displayName"),u=t.attr("code"),p=t.attr("codeSystem"),g=t.attr("codeSystemName"),y=(t=e.template("2.16.840.1.113883.10.20.1.54").tag("value")).attr("displayName"),h=t.attr("code"),v=t.attr("codeSystem");y||(t=e.template("2.16.840.1.113883.10.20.1.54").tag("text")).isEmpty()||(y=m.stripWhitespace(t.val()));var f=(t=e.template("2.16.840.1.113883.10.20.1.55").tag("value")).attr("displayName"),N=(t=e.tag("participant").tag("code")).attr("displayName"),C=t.attr("code"),_=t.attr("codeSystem"),S=t.attr("codeSystemName");N||(t=e.tag("participant").tag("name")).isEmpty()||(N=t.val()),N||(t=e.template("2.16.840.1.113883.3.88.11.83.6").tag("originalText")).isEmpty()||(N=m.stripWhitespace(t.val()));var T=(t=e.template("2.16.840.1.113883.10.20.1.39").tag("value")).attr("displayName");r.push({date_range:{start:n,end:i},name:s,code:o,code_system:c,code_system_name:l,status:T,severity:f,reaction:{name:y,code:h,code_system:v},reaction_type:{name:d,code:u,code_system:p,code_system_name:g},allergen:{name:N,code:C,code_system:_,code_system_name:S}})})),r},g.C32.demographics=function(e){var t,a=u.parseDate,r=u.parseName,n=u.parseAddress,i=e.section("demographics").tag("patientRole"),s=r(t=i.tag("patient").tag("name")),o=a((t=i.tag("patient")).tag("birthTime").attr("value")),c=m.Codes.gender(t.tag("administrativeGenderCode").attr("code")),l=m.Codes.maritalStatus(t.tag("maritalStatusCode").attr("code")),d=n(t=i.tag("addr")),p=(t=i.tag("telecom")).attr("value"),g=i.tag("languageCommunication").tag("languageCode").attr("code"),y=i.tag("raceCode").attr("displayName"),h=i.tag("ethnicGroupCode").attr("displayName"),v=i.tag("religiousAffiliationCode").attr("displayName"),f=n(t=i.tag("birthplace")),N=(t=i.tag("guardian")).tag("code").attr("displayName"),C=t.tag("code").attr("code"),_=t.tag("telecom").attr("value"),S=r(t=t.tag("guardianPerson").tag("name")),T=n(t=i.tag("guardian").tag("addr")),D=(t=i.tag("providerOrganization")).tag("name").val(),A=t.tag("telecom").attr("value"),b=n(t.tag("addr"));return{name:s,dob:o,gender:c,marital_status:l,address:d,phone:{home:p,work:null,mobile:null},email:null,language:g,race:y,ethnicity:h,religion:v,birthplace:{state:f.state,zip:f.zip,country:f.country},guardian:{name:{given:S.given,family:S.family},relationship:N,relationship_code:C,address:T,phone:{home:_}},provider:{organization:D,phone:A,address:b}}},g.C32.encounters=function(e){var t,a=u.parseDate,r=(u.parseName,u.parseAddress),n=[];return e.section("encounters").entries().each((function(e){var i=a(e.tag("effectiveTime").attr("value"));i||(i=a(e.tag("effectiveTime").tag("low").attr("value")));var s=(t=e.tag("code")).attr("displayName"),o=t.attr("code"),c=t.attr("codeSystem"),l=t.attr("codeSystemName"),m=t.attr("codeSystemVersion"),d=(t=e.tag("translation")).attr("displayName"),u=t.attr("code"),p=t.attr("codeSystem"),g=t.attr("codeSystemName"),y=(t=e.tag("performer")).tag("name").val(),h=t.attr("code"),v=t.attr("codeSystem"),f=t.attr("codeSystemName"),N=(t=e.tag("participant")).tag("name").val(),C=r(t);C.organization=N;for(var _=[],S=e.elsByTag("entryRelationship"),T=0;T<S.length;T++)t=S[T].tag("value"),_.push({name:t.attr("displayName"),code:t.attr("code"),code_system:t.attr("codeSystem")});n.push({date:i,name:s,code:o,code_system:c,code_system_name:l,code_system_version:m,findings:_,translation:{name:d,code:u,code_system:p,code_system_name:g},performer:{name:y,code:h,code_system:v,code_system_name:f},location:C})})),n},g.C32.immunizations=function(e){var t,a,r=u.parseDate,n=(u.parseName,u.parseAddress,[]),i=[];return e.section("immunizations").entries().each((function(e){t=e.tag("effectiveTime");var s=r(t.attr("value"));s||(s=r(t.tag("low").attr("value")));var o=(t=e.tag("substanceAdministration")).boolAttr("negationInd");a=e.template("2.16.840.1.113883.10.20.1.53");var c=(t=a.tag("code")).attr("displayName"),l=t.attr("code"),d=t.attr("codeSystem"),u=t.attr("codeSystemName"),p=(t=a.tag("translation")).attr("displayName"),g=t.attr("code"),y=t.attr("codeSystem"),h=t.attr("codeSystemName"),v=(t=a.tag("lotNumberText")).val(),f=(t=a.tag("manufacturerOrganization")).tag("name").val(),N=(t=e.tag("routeCode")).attr("displayName"),C=t.attr("code"),_=t.attr("codeSystem"),S=t.attr("codeSystemName");t=e.template("2.16.840.1.113883.10.20.1.49");var T=m.stripWhitespace(t.tag("text").val()),D=(t=t.tag("code")).attr("displayName"),A=t.attr("code"),b=t.attr("codeSystem"),R=(t=e.tag("doseQuantity")).attr("value"),E=t.attr("unit");(o?i:n).push({date:s,product:{name:c,code:l,code_system:d,code_system_name:u,translation:{name:p,code:g,code_system:y,code_system_name:h},lot_number:v,manufacturer_name:f},dose_quantity:{value:R,unit:E},route:{name:N,code:C,code_system:_,code_system_name:S},instructions:T,education_type:{name:D,code:A,code_system:b}})})),{administered:n,declined:i}},g.C32.results=function(e){var t,a=u.parseDate,r=(u.parseName,u.parseAddress,[]);return e.section("results").entries().each((function(e){t=e.tag("effectiveTime");var n=a(e.tag("effectiveTime").attr("value"));n||(n=a(e.tag("effectiveTime").tag("low").attr("value")));for(var i,s=(t=e.tag("code")).attr("displayName"),o=t.attr("code"),c=t.attr("codeSystem"),l=t.attr("codeSystemName"),d=e.elsByTag("observation"),u=[],p=0;p<d.length;p++)if((i=d[p]).template("2.16.840.1.113883.10.20.1.31").val()){var g=a(i.tag("effectiveTime").attr("value")),y=(t=i.tag("code")).attr("displayName"),h=t.attr("code"),v=t.attr("codeSystem"),f=t.attr("codeSystemName");y||(y=m.stripWhitespace(i.tag("text").val()));var N=(t=i.tag("translation")).attr("displayName"),C=t.attr("code"),_=t.attr("codeSystem"),S=t.attr("codeSystemName"),T=(t=i.tag("value")).attr("value"),D=t.attr("unit");T&&!isNaN(parseFloat(T))&&(T=parseFloat(T)),T||(T=t.val()),t=i.tag("referenceRange");var A=m.stripWhitespace(t.tag("observationRange").tag("text").val()),b=t.tag("observationRange").tag("low").attr("unit"),R=t.tag("observationRange").tag("low").attr("value"),E=t.tag("observationRange").tag("high").attr("unit"),P=t.tag("observationRange").tag("high").attr("value");u.push({date:g,name:y,value:T,unit:D,code:h,code_system:v,code_system_name:f,translation:{name:N,code:C,code_system:_,code_system_name:S},reference_range:{text:A,low_unit:b,low_value:R,high_unit:E,high_value:P}})}r.push({name:s,code:o,code_system:c,code_system_name:l,date:n,tests:u})})),r},g.C32.medications=function(e){var t,a=u.parseDate,r=[];return e.section("medications").entries().each((function(e){var n=null;(t=e.tag("substanceAdministration").immediateChildTag("text")).isEmpty()||(n=m.stripWhitespace(t.val()));var i=e.elsByTag("effectiveTime"),s=null,o=null;(t=i[0])&&(s=a(t.tag("low").attr("value")),o=a(t.tag("high").attr("value")));var c=null,l=null,d=null;if((t=i[1])&&"PIVL_TS"===t.attr("xsi:type")){var u=t.attr("institutionSpecified");"true"===u?c="frequency":"false"===u&&(c="interval"),l=(t=t.tag("period")).attr("value"),d=t.attr("unit")}var p=(t=e.tag("manufacturedProduct").tag("code")).attr("displayName"),g=t.attr("code"),y=t.attr("codeSystem"),h=null;(t=e.tag("manufacturedProduct").tag("originalText")).isEmpty()||(h=m.stripWhitespace(t.val())),!p&&h&&(p=h),p||(t=e.tag("manufacturedProduct").tag("name")).isEmpty()||(p=m.stripWhitespace(t.val()));var v=(t=e.tag("manufacturedProduct").tag("translation")).attr("displayName"),f=t.attr("code"),N=t.attr("codeSystem"),C=t.attr("codeSystemName"),_=(t=e.tag("doseQuantity")).attr("value"),S=t.attr("unit"),T=(t=e.tag("rateQuantity")).attr("value"),D=t.attr("unit"),A=(t=e.tag("precondition").tag("value")).attr("displayName"),b=t.attr("code"),R=t.attr("codeSystem"),E=(t=e.template("2.16.840.1.113883.10.20.1.28").tag("value")).attr("displayName"),P=t.attr("code"),j=t.attr("codeSystem"),O=(t=e.tag("routeCode")).attr("displayName"),I=t.attr("code"),M=t.attr("codeSystem"),H=t.attr("codeSystemName"),w=(t=e.tag("participant").tag("playingEntity")).tag("name").val();w=(t=t.tag("code")).attr("displayName")||w;var L=t.attr("code"),F=t.attr("codeSystem"),U=t.attr("codeSystemName"),B=(t=e.tag("administrationUnitCode")).attr("displayName"),x=t.attr("code"),G=t.attr("codeSystem"),W=t.attr("codeSystemName"),z=(t=e.tag("performer")).tag("name").val();r.push({date_range:{start:s,end:o},text:n,product:{name:p,text:h,code:g,code_system:y,translation:{name:v,code:f,code_system:N,code_system_name:C}},dose_quantity:{value:_,unit:S},rate_quantity:{value:T,unit:D},precondition:{name:A,code:b,code_system:R},reason:{name:E,code:P,code_system:j},route:{name:O,code:I,code_system:M,code_system_name:H},schedule:{type:c,period_value:l,period_unit:d},vehicle:{name:w,code:L,code_system:F,code_system_name:U},administration:{name:B,code:x,code_system:G,code_system_name:W},prescriber:{organization:z,person:null}})})),r},g.C32.problems=function(e){var t,a=u.parseDate,r=(u.parseName,u.parseAddress,[]);return e.section("problems").entries().each((function(e){t=e.tag("effectiveTime");var n=a(t.tag("low").attr("value")),i=a(t.tag("high").attr("value")),s=(t=e.template("2.16.840.1.113883.10.20.1.28").tag("value")).attr("displayName"),o=t.attr("code"),c=t.attr("codeSystem"),l=t.attr("codeSystemName");s||(t=e.template("2.16.840.1.113883.10.20.1.28").tag("originalText")).isEmpty()||(s=m.stripWhitespace(t.val()));var d=(t=e.template("2.16.840.1.113883.10.20.1.28").tag("translation")).attr("displayName"),u=t.attr("code"),p=t.attr("codeSystem"),g=t.attr("codeSystemName"),y=(t=e.template("2.16.840.1.113883.10.20.1.50")).tag("value").attr("displayName"),h=null;(t=e.template("2.16.840.1.113883.10.20.1.38")).isEmpty()||(h=parseFloat(t.tag("value").attr("value"))),r.push({date_range:{start:n,end:i},name:s,status:y,age:h,code:o,code_system:c,code_system_name:l,translation:{name:d,code:u,code_system:p,code_system_name:g},comment:null})})),r},g.C32.procedures=function(e){var t,a=u.parseDate,r=(u.parseName,u.parseAddress),n=[];return e.section("procedures").entries().each((function(e){t=e.tag("effectiveTime");var i=a(t.attr("value")),s=(t=e.tag("code")).attr("displayName"),o=t.attr("code"),c=t.attr("codeSystem");s||(s=m.stripWhitespace(e.tag("originalText").val()));var l=(t=e.tag("specimen").tag("code")).attr("displayName"),d=t.attr("code"),u=t.attr("codeSystem"),p=(t=e.tag("performer").tag("addr")).tag("name").val(),g=t.tag("telecom").attr("value"),y=r(t);y.organization=p,y.phone=g;var h=(t=e.tag("participant").tag("code")).attr("displayName"),v=t.attr("code"),f=t.attr("codeSystem");n.push({date:i,name:s,code:o,code_system:c,specimen:{name:l,code:d,code_system:u},performer:y,device:{name:h,code:v,code_system:f}})})),n},g.C32.vitals=function(e){var t,a=u.parseDate,r=(u.parseName,u.parseAddress,[]);return e.section("vitals").entries().each((function(e){t=e.tag("effectiveTime");for(var n,i=a(t.attr("value")),s=e.elsByTag("component"),o=[],c=0;c<s.length;c++){n=s[c];var l=(t=n.tag("code")).attr("displayName"),m=t.attr("code"),d=t.attr("codeSystem"),u=t.attr("codeSystemName");t=n.tag("value");var p=parseFloat(t.attr("value")),g=t.attr("unit");o.push({name:l,code:m,code_system:d,code_system_name:u,value:p,unit:g})}r.push({date:i,results:o})})),r},g.CCDA={run:function(e){var t={};return t.document=g.CCDA.document(e),t.allergies=g.CCDA.allergies(e),t.care_plan=g.CCDA.care_plan(e),t.chief_complaint=g.CCDA.free_text(e,"chief_complaint"),t.demographics=g.CCDA.demographics(e),t.encounters=g.CCDA.encounters(e),t.functional_statuses=g.CCDA.functional_statuses(e),t.immunizations=g.CCDA.immunizations(e).administered,t.immunization_declines=g.CCDA.immunizations(e).declined,t.instructions=g.CCDA.instructions(e),t.results=g.CCDA.results(e),t.medications=g.CCDA.medications(e),t.problems=g.CCDA.problems(e),t.procedures=g.CCDA.procedures(e),t.smoking_status=g.CCDA.smoking_status(e),t.vitals=g.CCDA.vitals(e),t.json=m.json,t.document.json=m.json,t.allergies.json=m.json,t.care_plan.json=m.json,t.chief_complaint.json=m.json,t.demographics.json=m.json,t.encounters.json=m.json,t.functional_statuses.json=m.json,t.immunizations.json=m.json,t.immunization_declines.json=m.json,t.instructions.json=m.json,t.results.json=m.json,t.medications.json=m.json,t.problems.json=m.json,t.procedures.json=m.json,t.smoking_status.json=m.json,t.vitals.json=m.json,t}},g.CCDA.document=function(e){for(var t,a=u.parseDate,r=u.parseName,n=u.parseAddress,i=e.section("document"),s=a(i.tag("effectiveTime").attr("value")),o=m.stripWhitespace(i.tag("title").val()),c=i.tag("author"),l=r(t=c.tag("assignedPerson").tag("name")),d=n(t=c.tag("addr")),p=(t=c.tag("telecom")).attr("value"),g=[],y=i.tag("documentationOf").elsByTag("performer"),h=0;h<y.length;h++){var v=r(t=y[h]),f=t.tag("telecom").attr("value"),N=n(t.tag("addr"));g.push({name:v,phone:{work:f},address:N})}t=i.tag("encompassingEncounter").tag("location");var C=m.stripWhitespace(t.tag("name").val()),_=n(t.tag("addr")),S=null;return(t=t.tag("effectiveTime")).isEmpty()||(S=a(t.attr("value"))),{date:s,title:o,author:{name:l,address:d,phone:{work:p}},documentation_of:g,location:{name:C,address:_,encounter_date:S}}},g.CCDA.allergies=function(e){var t,a=u.parseDate,r=(u.parseName,u.parseAddress,[]);return e.section("allergies").entries().each((function(e){t=e.tag("effectiveTime");var n=a(t.tag("low").attr("value")),i=a(t.tag("high").attr("value")),s=(t=e.template("2.16.840.1.113883.10.20.22.4.7").tag("code")).attr("displayName"),o=t.attr("code"),c=t.attr("codeSystem"),l=t.attr("codeSystemName"),d=(t=e.template("2.16.840.1.113883.10.20.22.4.7").tag("value")).attr("displayName"),u=t.attr("code"),p=t.attr("codeSystem"),g=t.attr("codeSystemName"),y=(t=e.template("2.16.840.1.113883.10.20.22.4.9").tag("value")).attr("displayName"),h=t.attr("code"),v=t.attr("codeSystem"),f=(t=e.template("2.16.840.1.113883.10.20.22.4.8").tag("value")).attr("displayName"),N=(t=e.tag("participant").tag("code")).attr("displayName"),C=t.attr("code"),_=t.attr("codeSystem"),S=t.attr("codeSystemName");N||(t=e.tag("participant").tag("name")).isEmpty()||(N=t.val()),N||(t=e.template("2.16.840.1.113883.10.20.22.4.7").tag("originalText")).isEmpty()||(N=m.stripWhitespace(t.val()));var T=(t=e.template("2.16.840.1.113883.10.20.22.4.28").tag("value")).attr("displayName");r.push({date_range:{start:n,end:i},name:s,code:o,code_system:c,code_system_name:l,status:T,severity:f,reaction:{name:y,code:h,code_system:v},reaction_type:{name:d,code:u,code_system:p,code_system_name:g},allergen:{name:N,code:C,code_system:_,code_system_name:S}})})),r},g.CCDA.care_plan=function(e){var t,a=[];return e.section("care_plan").entries().each((function(e){var r=null,n=null,i=null,s=null;(t=e.template("2.16.840.1.113883.10.20.22.4.40")).isEmpty()?(r=(t=e.tag("code")).attr("displayName"),n=t.attr("code"),i=t.attr("codeSystem"),s=t.attr("codeSystemName")):r="encounter";var o=m.stripWhitespace(e.tag("text").val());a.push({text:o,name:r,code:n,code_system:i,code_system_name:s})})),a},g.CCDA.demographics=function(e){var t,a=u.parseDate,r=u.parseName,n=u.parseAddress,i=e.section("demographics").tag("patientRole"),s=r(t=i.tag("patient").tag("name")),o=a((t=i.tag("patient")).tag("birthTime").attr("value")),c=m.Codes.gender(t.tag("administrativeGenderCode").attr("code")),l=m.Codes.maritalStatus(t.tag("maritalStatusCode").attr("code")),d=n(t=i.tag("addr")),p=(t=i.tag("telecom")).attr("value"),g=i.tag("languageCommunication").tag("languageCode").attr("code"),y=i.tag("raceCode").attr("displayName"),h=i.tag("ethnicGroupCode").attr("displayName"),v=i.tag("religiousAffiliationCode").attr("displayName"),f=n(t=i.tag("birthplace")),N=(t=i.tag("guardian")).tag("code").attr("displayName"),C=t.tag("code").attr("code"),_=t.tag("telecom").attr("value"),S=r(t=t.tag("guardianPerson").tag("name")),T=n(t=i.tag("guardian").tag("addr")),D=(t=i.tag("providerOrganization")).tag("name").val(),A=t.tag("telecom").attr("value"),b=n(t.tag("addr"));return{name:s,dob:o,gender:c,marital_status:l,address:d,phone:{home:p,work:null,mobile:null},email:null,language:g,race:y,ethnicity:h,religion:v,birthplace:{state:f.state,zip:f.zip,country:f.country},guardian:{name:{given:S.given,family:S.family},relationship:N,relationship_code:C,address:T,phone:{home:_}},provider:{organization:D,phone:A,address:b}}},g.CCDA.encounters=function(e){var t,a=u.parseDate,r=(u.parseName,u.parseAddress),n=[];return e.section("encounters").entries().each((function(e){var i=a(e.tag("effectiveTime").attr("value")),s=(t=e.tag("code")).attr("displayName"),o=t.attr("code"),c=t.attr("codeSystem"),l=t.attr("codeSystemName"),m=t.attr("codeSystemVersion"),d=(t=e.tag("translation")).attr("displayName"),u=t.attr("code"),p=t.attr("codeSystem"),g=t.attr("codeSystemName"),y=(t=e.tag("performer").tag("code")).attr("displayName"),h=t.attr("code"),v=t.attr("codeSystem"),f=t.attr("codeSystemName"),N=(t=e.tag("participant")).tag("code").attr("displayName"),C=r(t);C.organization=N;for(var _=[],S=e.elsByTag("entryRelationship"),T=0;T<S.length;T++)t=S[T].tag("value"),_.push({name:t.attr("displayName"),code:t.attr("code"),code_system:t.attr("codeSystem")});n.push({date:i,name:s,code:o,code_system:c,code_system_name:l,code_system_version:m,findings:_,translation:{name:d,code:u,code_system:p,code_system_name:g},performer:{name:y,code:h,code_system:v,code_system_name:f},location:C})})),n},g.CCDA.free_text=function(e,t){var a=e.section(t);return{text:m.stripWhitespace(a.tag("text").val())}},g.CCDA.functional_statuses=function(e){var t,a=u.parseDate,r=[];return e.section("functional_statuses").entries().each((function(e){var n=a(e.tag("effectiveTime").attr("value"));n||(n=a(e.tag("effectiveTime").tag("low").attr("value")));var i=(t=e.tag("value")).attr("displayName"),s=t.attr("code"),o=t.attr("codeSystem"),c=t.attr("codeSystemName");r.push({date:n,name:i,code:s,code_system:o,code_system_name:c})})),r},g.CCDA.immunizations=function(e){var t,a,r=u.parseDate,n=(u.parseName,u.parseAddress,[]),i=[];return e.section("immunizations").entries().each((function(e){t=e.tag("effectiveTime");var s=r(t.attr("value"));s||(s=r(t.tag("low").attr("value")));var o=(t=e.tag("substanceAdministration")).boolAttr("negationInd");a=e.template("2.16.840.1.113883.10.20.22.4.54");var c=(t=a.tag("code")).attr("displayName"),l=t.attr("code"),d=t.attr("codeSystem"),u=t.attr("codeSystemName"),p=(t=a.tag("translation")).attr("displayName"),g=t.attr("code"),y=t.attr("codeSystem"),h=t.attr("codeSystemName"),v=(t=a.tag("lotNumberText")).val(),f=(t=a.tag("manufacturerOrganization")).tag("name").val(),N=(t=e.tag("routeCode")).attr("displayName"),C=t.attr("code"),_=t.attr("codeSystem"),S=t.attr("codeSystemName");t=e.template("2.16.840.1.113883.10.20.22.4.20");var T=m.stripWhitespace(t.tag("text").val()),D=(t=t.tag("code")).attr("displayName"),A=t.attr("code"),b=t.attr("codeSystem"),R=(t=e.tag("doseQuantity")).attr("value"),E=t.attr("unit");(o?i:n).push({date:s,product:{name:c,code:l,code_system:d,code_system_name:u,translation:{name:p,code:g,code_system:y,code_system_name:h},lot_number:v,manufacturer_name:f},dose_quantity:{value:R,unit:E},route:{name:N,code:C,code_system:_,code_system_name:S},instructions:T,education_type:{name:D,code:A,code_system:b}})})),{administered:n,declined:i}},g.CCDA.instructions=function(e){var t,a=[];return e.section("instructions").entries().each((function(e){var r=(t=e.tag("code")).attr("displayName"),n=t.attr("code"),i=t.attr("codeSystem"),s=t.attr("codeSystemName"),o=m.stripWhitespace(e.tag("text").val());a.push({text:o,name:r,code:n,code_system:i,code_system_name:s})})),a},g.CCDA.results=function(e){var t,a=u.parseDate,r=(u.parseName,u.parseAddress,[]);return e.section("results").entries().each((function(e){for(var n,i=(t=e.tag("code")).attr("displayName"),s=t.attr("code"),o=t.attr("codeSystem"),c=t.attr("codeSystemName"),l=e.elsByTag("observation"),d=[],u=0;u<l.length;u++){n=l[u];var p=a(n.tag("effectiveTime").attr("value")),g=(t=n.tag("code")).attr("displayName"),y=t.attr("code"),h=t.attr("codeSystem"),v=t.attr("codeSystemName");g||(g=m.stripWhitespace(n.tag("text").val()));var f=(t=n.tag("translation")).attr("displayName"),N=t.attr("code"),C=t.attr("codeSystem"),_=t.attr("codeSystemName"),S=(t=n.tag("value")).attr("value"),T=t.attr("unit");S&&!isNaN(parseFloat(S))&&(S=parseFloat(S)),S||(S=t.val()),t=n.tag("referenceRange");var D=m.stripWhitespace(t.tag("observationRange").tag("text").val()),A=t.tag("observationRange").tag("low").attr("unit"),b=t.tag("observationRange").tag("low").attr("value"),R=t.tag("observationRange").tag("high").attr("unit"),E=t.tag("observationRange").tag("high").attr("value");d.push({date:p,name:g,value:S,unit:T,code:y,code_system:h,code_system_name:v,translation:{name:f,code:N,code_system:C,code_system_name:_},reference_range:{text:D,low_unit:A,low_value:b,high_unit:R,high_value:E}})}r.push({name:i,code:s,code_system:o,code_system_name:c,tests:d})})),r},g.CCDA.medications=function(e){var t,a=u.parseDate,r=[];return e.section("medications").entries().each((function(e){t=e.tag("text");var n=m.stripWhitespace(t.val()),i=e.elsByTag("effectiveTime"),s=null,o=null;(t=i[0])&&(s=a(t.tag("low").attr("value")),o=a(t.tag("high").attr("value")));var c=null,l=null,d=null;if((t=i[1])&&"PIVL_TS"===t.attr("xsi:type")){var u=t.attr("institutionSpecified");"true"===u?c="frequency":"false"===u&&(c="interval"),l=(t=t.tag("period")).attr("value"),d=t.attr("unit")}var p=(t=e.tag("manufacturedProduct").tag("code")).attr("displayName"),g=t.attr("code"),y=t.attr("codeSystem"),h=null;(t=e.tag("manufacturedProduct").tag("originalText")).isEmpty()||(h=m.stripWhitespace(t.val())),!p&&h&&(p=h);var v=(t=e.tag("manufacturedProduct").tag("translation")).attr("displayName"),f=t.attr("code"),N=t.attr("codeSystem"),C=t.attr("codeSystemName"),_=(t=e.tag("doseQuantity")).attr("value"),S=t.attr("unit"),T=(t=e.tag("rateQuantity")).attr("value"),D=t.attr("unit"),A=(t=e.tag("precondition").tag("value")).attr("displayName"),b=t.attr("code"),R=t.attr("codeSystem"),E=(t=e.template("2.16.840.1.113883.10.20.22.4.19").tag("value")).attr("displayName"),P=t.attr("code"),j=t.attr("codeSystem"),O=(t=e.tag("routeCode")).attr("displayName"),I=t.attr("code"),M=t.attr("codeSystem"),H=t.attr("codeSystemName"),w=(t=e.tag("participant").tag("playingEntity")).tag("name").val();w=(t=t.tag("code")).attr("displayName")||w;var L=t.attr("code"),F=t.attr("codeSystem"),U=t.attr("codeSystemName"),B=(t=e.tag("administrationUnitCode")).attr("displayName"),x=t.attr("code"),G=t.attr("codeSystem"),W=t.attr("codeSystemName"),z=(t=e.tag("performer")).tag("name").val();r.push({date_range:{start:s,end:o},text:n,product:{name:p,code:g,code_system:y,text:h,translation:{name:v,code:f,code_system:N,code_system_name:C}},dose_quantity:{value:_,unit:S},rate_quantity:{value:T,unit:D},precondition:{name:A,code:b,code_system:R},reason:{name:E,code:P,code_system:j},route:{name:O,code:I,code_system:M,code_system_name:H},schedule:{type:c,period_value:l,period_unit:d},vehicle:{name:w,code:L,code_system:F,code_system_name:U},administration:{name:B,code:x,code_system:G,code_system_name:W},prescriber:{organization:z,person:null}})})),r},g.CCDA.problems=function(e){var t,a=u.parseDate,r=(u.parseName,u.parseAddress,[]);return e.section("problems").entries().each((function(e){t=e.tag("effectiveTime");var n=a(t.tag("low").attr("value")),i=a(t.tag("high").attr("value")),s=(t=e.template("2.16.840.1.113883.10.20.22.4.4").tag("value")).attr("displayName"),o=t.attr("code"),c=t.attr("codeSystem"),l=t.attr("codeSystemName"),d=(t=e.template("2.16.840.1.113883.10.20.22.4.4").tag("translation")).attr("displayName"),u=t.attr("code"),p=t.attr("codeSystem"),g=t.attr("codeSystemName"),y=(t=e.template("2.16.840.1.113883.10.20.22.4.6")).tag("value").attr("displayName"),h=null;(t=e.template("2.16.840.1.113883.10.20.22.4.31")).isEmpty()||(h=parseFloat(t.tag("value").attr("value"))),t=e.template("2.16.840.1.113883.10.20.22.4.64");var v=m.stripWhitespace(t.tag("text").val());r.push({date_range:{start:n,end:i},name:s,status:y,age:h,code:o,code_system:c,code_system_name:l,translation:{name:d,code:u,code_system:p,code_system_name:g},comment:v})})),r},g.CCDA.procedures=function(e){var t,a=u.parseDate,r=(u.parseName,u.parseAddress),n=[];return e.section("procedures").entries().each((function(e){t=e.tag("effectiveTime");var i=a(t.attr("value")),s=(t=e.tag("code")).attr("displayName"),o=t.attr("code"),c=t.attr("codeSystem");s||(s=m.stripWhitespace(e.tag("originalText").val()));var l=(t=e.tag("specimen").tag("code")).attr("displayName"),d=t.attr("code"),u=t.attr("codeSystem"),p=(t=e.tag("performer").tag("addr")).tag("name").val(),g=t.tag("telecom").attr("value"),y=r(t);y.organization=p,y.phone=g;var h=(t=e.template("2.16.840.1.113883.10.20.22.4.37").tag("code")).attr("displayName"),v=t.attr("code"),f=t.attr("codeSystem");n.push({date:i,name:s,code:o,code_system:c,specimen:{name:l,code:d,code_system:u},performer:y,device:{name:h,code:v,code_system:f}})})),n},g.CCDA.smoking_status=function(e){for(var t,a=u.parseDate,r=(u.parseName,u.parseAddress,null),n=null,i=null,s=null,o=null,c=e.section("social_history").entries(),l=0;l<c.length;l++){var m=c[l],d=m.template("2.16.840.1.113883.10.20.22.4.78");if(d.isEmpty()&&(d=m.template("2.16.840.1.113883.10.22.4.78")),!d.isEmpty()&&(o=a((t=d.tag("effectiveTime")).attr("value")),r=(t=d.tag("value")).attr("displayName"),n=t.attr("code"),i=t.attr("codeSystem"),s=t.attr("codeSystemName"),r))break}return{date:o,name:r,code:n,code_system:i,code_system_name:s}},g.CCDA.vitals=function(e){var t,a=u.parseDate,r=(u.parseName,u.parseAddress,[]);return e.section("vitals").entries().each((function(e){t=e.tag("effectiveTime");for(var n,i=a(t.attr("value")),s=e.elsByTag("component"),o=[],c=0;c<s.length;c++){n=s[c];var l=(t=n.tag("code")).attr("displayName"),m=t.attr("code"),d=t.attr("codeSystem"),u=t.attr("codeSystemName");t=n.tag("value");var p=parseFloat(t.attr("value")),g=t.attr("unit");o.push({name:l,code:m,code_system:d,code_system_name:u,value:p,unit:g})}r.push({date:i,results:o})})),r};return function(e,t){var a,r,n;if(t||(t={}),r=m.parseData(e),t.parser)n=t.parser();else switch(a=u.detect(r)){case"c32":r=u.C32.process(r),n=g.C32.run(r);break;case"ccda":r=u.CCDA.process(r),n=g.CCDA.run(r);break;case"json":switch(t.generatorType){case"c32":a="c32",n=p.C32.run(r,t.template,t.testingMode);break;case"ccda":a="ccda",n=p.CCDA.run(r,t.template,t.testingMode)}}return{type:a,data:n,source:r}}}));
//# sourceMappingURL=/sm/6b0cf3db179d17073b0c6f0af68da0b9a6411292cc71d95e873b3d9a9089380c.map