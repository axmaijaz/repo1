<h1 class="page-title">Profile</h1>
<div class="row" *ngIf="isLoading">


  <div class="col-lg-4 col-sm-12">
    <div class="card testimonial-card mb-3 overflow-hidden">
      <div class="card-up bg-dynamic-2c"></div>
      <div class="w-100 avatar mx-auto bg-dynamic-secondary-2c d-flex align-items-center justify-content-center"
        style="height: 120px;">
        <h4><strong class="text-white">{{user.nameAbbrevation}}</strong></h4>
      </div>
      <div class="card-body">
        <h4 class="card-title">{{user.lastName}},{{user.firstName}}</h4>
        <!-- <h6>User Id:{{user.userName}}</h6> -->
        <a><small class="font-600 text-dynamic-2c" (click)="changePasswordModal.show();">Change
            Password</small></a>
            <!-- <div class="d-flex justify-content-between mb-0 hoverss">
              <button class="btn" mdbBtn *ngIf="twoFactorEnabled==='No'"><small
              (click)="GetAuthenticatorKey(twoFactorConfModal)">
              Enable Two Factor Auth</small></button> -->
          <!-- <button class="btn" mdbBtn [disabled]="disablingTwoFA" (click)="DisbleTwoFactorAuthentication()" *ngIf="twoFactorEnabled==='Yes'"><small>
            Disable Two Factor Auth</small></button> -->
          <!-- <button class="btn btn-dynamic-2c" *ngIf="twoFactorEnabled==='No'" [disabled]="isLoading1" mdbBtn (click)="get2FAInfoPdf()"> <span
              *ngIf="isLoading1" class="spinner-border spinner-border-sm" role="status"
              aria-hidden="true"></span><small>
              2FA Pdf</small></button> -->
          <!-- <small class="text-dynamic-2c" *ngIf="twoFactorEnabled">{{twoFactorEnabled}}</small> -->
     <!-- b    </div> -->
      </div>
    </div>
    <div class="panel">
      <div class="panel-header">
        <div class="col-sm-12">
          <div class="row">
          <h4><strong class="text-dynamic-secondary-2c">Organizational Information</strong></h4>
          </div>
        </div>
      </div>
      <div class="panel-body">
        <div class="row text-left">
          <div class="col-sm-12">
            <p class="mb-0"><small class="font-600 text-dynamic-2c">Name</small></p>
            <p>{{user.organization.name}}</p>
          </div>
          <div class="col-sm-12">
            <p class="mb-0"><small class="font-600 text-dynamic-2c">Contact Email</small></p>
            <p>{{user.organization.contactEmail}}</p>
          </div>
          <div class="col-sm-12">
            <p class="mb-0"><small class="font-600 text-dynamic-2c">Contact Number</small></p>
            <p>{{user.organization.contactNumber}}</p>
          </div>
          <div class="col-sm-12">
            <p class="mb-0"><small class="font-600 text-dynamic-2c">Website</small></p>
            <p>{{user.organization.website}}</p>
            <hr>
          </div>
        </div>
      </div>
    </div>
    <div class="panel">
      <div class="panel-header">
        <div class="row">
          <div class="col-sm-12 d-flex justify-content-between">
          <h4><strong class="text-dynamic-secondary-2c">2 Factor Authentication </strong></h4>
            <button *ngIf="user.twoFactorEnabled"  [disabled]="disablingTwoFA || user.isLocumCareProvider" class="btn btn-dynamic-2c btn-sm px-sm-4 px-3"  (click)="DisableTwoFactorAuthentication()">
              <span *ngIf="disablingTwoFA" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Disable</button>
          </div>
        </div>
      </div>
      <div class="panel-body">
        <!-- <div class="row text-left" *ngIf="!user.hasAuthenticator"> -->
        <div class="row text-left" *ngIf="!user.twoFactorEnabled">
          <div class="col-sm-12 mb-3">
            <p class="mb-3">Scan the QR code with your authenticator app to received verification code</p>
            <button class="btn btn-dynamic-2c px-3 py-2 m-0"
              (click)="GetAuthenticatorKey(twoFactorConfModal)" > Setup Now</button>
          </div>
          <div class="col-sm-12">
            <ul class="smartApplication text-right" style="display: flex;
            align-items: center;
            justify-content: end;">
              <li class="mr-3" title="Play Store"><a (click)="navigateOnPlaystore()"><img src="assets/img/playstore.png" width="35"></a></li>
              <li  class="mr-3" title="App Store"><a (click)="navigateOnIStore()"><img src="assets/img/App-store-icon.png" width="35"></a></li>
              <li class="mr-4" title="Scan QR Code"><a (click)="scanDownload.show()"><span class="fa fa-qrcode" style="font-size:35px ;"></span></a></li>
            </ul>
          </div>
        </div>
        <!-- <div class="row text-left" *ngIf="user.hasAuthenticator"> -->
        <div class="row text-left" *ngIf="user.twoFactorEnabled">
          <div class="col-sm-12">
            <p class="mb-3 font-600 text-center">Authentication app is already configured</p>
          </div>
          <div class="col-sm-12">
            <ul class="smartApplication">
              <li> <span class="fa fa-check auth-circle-check"></span></li>
            </ul>
            <p class="my-3 text-center">Do you want to configure it again? <a class="setup-link" (click)="GetAuthenticatorKey(twoFactorConfModal)">Setup Now</a></p>
          </div>
          <div class="col-sm-12">
            <ul class="smartApplication text-right" style="display: flex;
            align-items: center;
            justify-content: end;">
              <li class="mr-3" title="Play Store"><a (click)="navigateOnPlaystore()"><img src="assets/img/playstore.png" width="35"></a></li>
              <li  class="mr-3" title="App Store"><a (click)="navigateOnIStore()"><img src="assets/img/App-store-icon.png" width="35"></a></li>
              <li class="mr-4" title="Scan QR Code"><a (click)="scanDownload.show()"><span class="fa fa-qrcode" style="font-size:35px ;"></span></a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-lg-8 col-sm-12">
    <div class="panel">
      <div class="panel-body">
        <div class="row text-left">
          <div class="col-sm-12">
          <h4><strong class="text-dynamic-secondary-2c">Personal Information</strong></h4>
          </div>
          <div class="col-sm-6">
            <p class="mb-0"><small class="font-600 text-dynamic-2c">Name</small></p>
            <p>{{user.lastName}},{{user.firstName}}</p>
          </div>
          <!-- <div class="col-sm-6">
            <p class="mb-0"><small class="font-600 text-dynamic-2c">EMR Id</small></p>
            <p>{{user.patientEmrId}}</p>
          </div> -->
          <!-- <div class="col-sm-6">
            <p class="mb-0"><small class="font-600 text-dynamic-2c">Gender</small></p>
            <p></p>
          </div>
          <div class="col-sm-6">
            <p class="mb-0"><small class="font-600 text-dynamic-2c">Date of Birth</small></p>
            <p></p>
          </div> -->
        </div>
        <hr>
        <div class="row text-left">
          <div class="col-sm-12 d-flex justify-content-between mb-3">
          <h4><strong class="text-dynamic-secondary-2c">Contact Information</strong></h4>
            <a class="text-dynamic-2c ml-2 " (click)="email= user.email;phoneNo= phoneNumberWithoutMask;editFacilityUserModal.show()"
              ><i class="fa fa-pencil"></i> Edit</a>
          </div>

          <div class="col-sm-6">
            <p class="mb-0"><small class="font-600 text-dynamic-2c">Phone No.</small></p>
            <p>{{user.phoneNo}}</p>
            <a class="link text-danger" *ngIf="user.phoneNo && user.isPhoneNumberVerified === false;"
              (click)="sendPhoneNoVerificationToken(user);">verify phone</a>
            <strong class=" text-dynamic-2c"
              *ngIf="user.phoneNo && user.isPhoneNumberVerified === true;">(Verified)</strong>
            <!-- <p class="mb-0 hoverss"><a><small class="font-600 text-dynamic-2c" (click)="changePasswordModal.show();">Change
              Password</small></a></p> -->
          </div>
          <div class="col-sm-6">
            <p class="mb-0"><small class="font-600 text-dynamic-2c">Email.</small></p>
            <p>{{user.email}}</p>
            <a class="link text-danger" *ngIf="user.email && user.isEmailVerified  === false;"
              (click)="sendVerifyEmail(user)">verify email</a>
            <strong class=" text-dynamic-2c" *ngIf="user.email && user.isEmailVerified  === true;">(Verified)</strong>
            <!-- <p class="mb-0 hoverss"><a><small class="font-600 text-dynamic-2c" (click)="changePasswordModal.show();">Change
              Password</small></a></p> -->
          </div>
          <!-- <div class="col-sm-6">
            <p class="mb-0"><small class="font-600 text-dynamic-2c">Secondary Contact No.</small></p>
            <p>{{user.personNumber}}</p>
          </div> -->
        </div>
        <hr>
        <div class="row text-left">
          <div class="col-sm-12 d-flex justify-content-between mb-3">
          <h4><strong class="text-dynamic-secondary-2c">Role</strong></h4>
          </div>

          <div class="col-sm-12">
            <!-- <p class="mb-0"><small class="font-600 text-dynamic-2c"></small></p>
            <p> {{user.roles}} </p> -->
            <div class="tags">
              <!-- <strong class="tags-title">Is Chronic</strong> -->
              <ul class="tag-list">
                <li class="tag" *ngFor="let roles of user.roles.split(',')">
                  {{roles}}</li>
              </ul>
            </div>
          </div>
        </div>
        <hr>
        <div class="row text-left">
          <div class="col-sm-12 d-flex justify-content-between mb-3">
          <h4><strong class="text-dynamic-secondary-2c">Assigned Facilities</strong></h4>
          </div>

          <div class="col-sm-12">
            <!-- <p class="mb-0"><small class="font-600 text-dynamic-2c"></small></p>
            <p>{{user.facilityDto.facilityName}}</p> -->
            <div class="tags">
              <!-- <strong class="tags-title">Is Chronic</strong> -->
              <ul class="tag-list">
                <li class="tag" *ngFor="let item of user.assignedFacilities">
                  {{item}}</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="panel">
      <div class="panel-header">
        <h4 class="text-dynamic-secondary-2c"><strong>2C-Health Complimentary Apps</strong></h4>
      </div>
      <div class="panel-body">
        <div class="row">
          <div class="col-sm-6 text-center ">
            <div class="py-4">
              <h5 class="mb-3 text-dynamic-2c"><strong>2C-Health Mobile App</strong></h5>
              <ul class="smartApplication text-center" style="display: flex;
                align-items: center;
                justify-content: center;">
                  <li class="mr-3" title="Click on the icon to Download Mobile App"><a (click)="navigateOnTwoCHealth()" ><img src="assets/img/playstore.png" width="70"></a></li>
                  <li  class="mr-3" title="Click on the icon to Download Mobile App"><a (click)="navigateOnTwoCHealthIphone()"><img src="assets/img/App-store-icon.png" width="70"></a></li>
              </ul>
            </div>
            
          </div>
          <div class="col-sm-6 text-center">
            <div class="py-4">
              <h5 class="mb-3 text-dynamic-2c"><strong>2C-Health Chrome Extention</strong></h5>
              <a title="Click on the icon to Download Chrome Extention" (click)="navigateOnTwoCHealthExtenstion()">
                <img height="70" src="../../../assets/img/Chrome_Web_Store.png">
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<div mdbModal #changePasswordModal="mdbModal" class="modal fade" tabindex="-1" role="dialog"
  [config]="{ignoreBackdropClick: true}" aria-labelledby="mychangePasswordModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <!-- <button type="button" class="close pull-right" aria-label="Close" (click)="changePasswordModal.hide()">
          <span aria-hidden="true">×</span>
        </button> -->
        <h4 class="modal-title w-100 text-center" id="myModalLabel">Change Password</h4>
      </div>
      <div class="modal-body" *ngIf="changePasswordModal.isShown">
        <!-- <div class="alert alert-info p-2 pb-3">
          <a class="close font-weight-normal initialism" data-dismiss="alert" href="#"><samp>&times;</samp></a>
          CVC code is required.
        </div> -->
        <form class="form" role="form" autocomplete="off" [formGroup]="changePasswordForm">
          <div class="form-group">
            <label for="inputPasswordOld">Current Password</label>
            <input type="password" class="form-control" formControlName="oldPassword" id="inputPasswordOld" required="">
          </div>
          <div class="form-group">
            <label for="inputPasswordNew">New Password</label>
            <input type="password" class="form-control" formControlName="newPassword" id="inputPasswordNew" required="">
            <span class="form-text small text-muted">
              The password must be 8-20 characters, and must <em>not</em> contain spaces.
            </span>
          </div>
          <div class="form-group">
            <label for="inputPasswordNewVerify">Verify</label>
            <input type="password" class="form-control" formControlName="verifyPassword" id="inputPasswordNewVerify"
              required="">
            <span class="form-text small text-muted">
              To confirm, type the new password again.
            </span>
            <small *ngIf="changePasswordForm.get('newPassword').value && changePasswordForm.get('verifyPassword').value &&
            changePasswordForm.get('newPassword').value !== changePasswordForm.get('verifyPassword').value &&
            changePasswordForm.get('verifyPassword').touched" class="text-danger">
              password mismatch
            </small>
          </div>
          <!-- <div class="form-group">
                  <button type="submit" class="btn btn-success btn-lg float-right">Save</button>
              </div> -->
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="waves-light btn btn-sm btn-dynamic-secondary-2c" aria-label="Close"
          (click)="changePasswordModal.hide()" mdbWavesEffect>Close</button>
        <button
          [disabled]="!changePasswordForm.get('newPassword').value || !changePasswordForm.get('verifyPassword').value ||
        changePasswordForm.get('newPassword').value !== changePasswordForm.get('verifyPassword').value || !changePasswordForm.get('oldPassword').value"
          type="button" class="relative waves-light btn btn-sm btn-dynamic-secondary-2c" mdbWavesEffect
          (click)="changePasswordModal.hide();changePassword()">Update</button>
      </div>
    </div>
  </div>
</div>
<div mdbModal #twoFactorConfModal="mdbModal" (close)="qrCOdeString='';codeString='';isAuthenticationSuccess= false;showQRCode = true" class="modal fade" tabindex="-1"
  role="dialog" [config]="{ignoreBackdropClick: true}" aria-labelledby="mytwoFactorConfModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <!-- <button type="button" class="close pull-right" aria-label="Close" (click)="twoFactorConfModal.hide()">
          <span aria-hidden="true">×</span>
        </button> -->
        <h4 class="modal-title w-100 text-center" id="myModalLabel">Configuration</h4>
      </div>
      <form (ngSubmit)="RegisterAuthenticator(twoFactorConfModal)">
        <div class="modal-body" *ngIf="twoFactorConfModal.isShown">
          <!-- <div class="alert alert-info p-2 pb-3">
          <a class="close font-weight-normal initialism" data-dismiss="alert" href="#"><samp>&times;</samp></a>
          CVC code is required.
        </div> -->
          <div *ngIf="gettingKey" class="d-flex justify-content-center text-center">
            <mdb-progress-bar class="progress primary-color-dark mb-0" mode="indeterminate"></mdb-progress-bar>
          </div>
          <div class="form">
            <ng-container *ngIf="!isAuthenticationSuccess">
              <ng-container *ngIf="!showQRCode">
                <label>Enter the verification code generated by your authentication app. </label>
                <div class="form-group">
                  <label for="twofacCOdeid">Enter Code:</label>
                  <input type="text" class="form-control" name="code" [(ngModel)]="codeString" id="twofacCOdeid" required="">
                </div>
              </ng-container>
              <ng-container *ngIf="showQRCode">
                <div class="row" *ngIf="qrCOdeString">
                  <div class="col-12">
                    <label for="twofacCOdeid98">Scan the QR code with your authenticator app to receive codes. </label>
                    <div class="text-center">
                      <qrcode [qrdata]="qrCOdeString" [width]="256" [errorCorrectionLevel]="'M'"></qrcode>
                      <button type="button" (click)="showQRCode = false"  class="waves-light btn btn-dynamic-2c btn-sm" aria-label="next"
                       mdbWavesEffect>Next</button>
                    </div>
                  </div>
                </div>
              </ng-container>
            </ng-container>
            <ng-container *ngIf="isAuthenticationSuccess">
              <div class="row text-left">
                <div class="col-sm-12">
                  <ul class="smartApplication">
                    <li><a> <span class="fa fa-check auth-circle-check"></span> </a></li>
                  </ul>
                  <p class="mt-3 mb-2 font-600 text-center text-success">SUCCESS !!</p>
                  <p class="mb-3 font-600 text-center">Authentication app is configured. Thank you</p>
                </div>
              </div>
            </ng-container>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="waves-light btn btn-sm btn-dynamic-secondary-2c" aria-label="Close"
            (click)="twoFactorConfModal.hide()" mdbWavesEffect>Close</button>
          <button type="submit" *ngIf="!showQRCode && !isAuthenticationSuccess" [disabled]="gettingKey" class="relative waves-light btn btn-sm btn-dynamic-2c"
            mdbWavesEffect>
            <span *ngIf="gettingKey" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            Proceed</button>
        </div>
      </form>
    </div>
  </div>
</div>
<div mdbModal #verificationModal="mdbModal" class="modal fade" tabindex="-1" role="dialog"
  aria-labelledby="myBasicModalLabel" [config]="{ignoreBackdropClick: true}" aria-hidden="true">
  <div class="modal-dialog modal-md" role="document">
    <div class="modal-content">
      <button type="button" class="close pull-right mt-2" style="z-index: 1" aria-label="Close"
        (click)="verificationModal.hide()">
        <span aria-hidden="true">×</span>
      </button>
      <div class="modal-body p-4">
        <div class="text-center">
          <h3 class="mb-3">SMS Verification</h3>
          <p>An OTP (One Time Password) has been sent to the following number. Please enter the OTP in the field below
            to verify. </p>
          <div class="mf-info">
            <p><span>Name:</span> {{verificationUserName}}</p>
            <p><span>Country Calling Code:</span> {{selectedUserCountryCallingCode}}</p>
            <p><span>Mobile:</span> {{sendPhoneNoVerifictionDto.phoneNumber}}</p>
          </div>

          <div class="verification-code">
            <input type="text" [(ngModel)]="verifyPhoneNoDto.code" [minLength]="0" mask="000000"
              placeholder="Enter Code" [maxLength]="6">
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
            <span></span>
          </div>

          <button class="btn btn-dynamic-2c btn-sm" [disabled]="!this.sendPhoneNoVerifictionDto.countryCallingCode" (click)="verifyPhoneNumber()">Verify</button>
        </div>
      </div>
      <!-- <div class="modal-footer">
        <button type="button" mdbBtn color="seconary" class="waves-light" aria-label="Close"
          (click)="verificationModal.hide()" mdbWavesEffect>Close</button>
        <button type="button" mdbBtn color="primry" class="relative waves-light" mdbWavesEffect>Save!</button>
      </div> -->
    </div>
  </div>
</div>
<div mdbModal #scanDownload="mdbModal" class="modal fade" tabindex="-1"
  role="dialog" [config]="{ignoreBackdropClick: true}" aria-labelledby="scanDownloadLabel" aria-hidden="true">
  <div class="modal-dialog modal-md modal-dialog-scrollable" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title w-100" id="myModalLabel">QR Code</h4>
      </div>
      <div class="modal-body" >
        <div class="row">
          <div class="col-md-12">
            <p>Scan for Download "Authentication Mobile App".</p>
          </div>
          <div class="col-md-6 text-center">
            <h6 style="font-weight:600 ;">QR Code Google Store</h6>
            <img class="img-fluid" width="150px" src="../../../assets/img/qr-playstore.svg">
          </div>
          <div class="col-md-6 text-center">
            <h6 style="font-weight:600 ;">QR Code Apple Store</h6>
            <img class="img-fluid" width="150px" src="../../../assets/img/qr-appstore.svg">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="waves-light btn btn-sm btn-dynamic-secondary-2c" aria-label="Close"
          (click)="scanDownload.hide()" mdbWavesEffect>Close
        </button>
      </div>
    </div>
  </div>
</div>
<div style="overflow-y: auto" mdbModal #editFacilityUserModal="mdbModal" [config]="{ignoreBackdropClick: true}" class="modal fade" tabindex="-1" role="dialog"
  aria-labelledby="myBasicModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg flat-modal" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close pull-right" aria-label="Close"
          (click)="editFacilityUserModal.hide()">
          <span aria-hidden="true">×</span>
        </button>
        <h4 class="modal-title w-100" id="myModalLabel">Edit Contact Information</h4>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-sm-12" >
            <div class="row">
              <div class="col-sm-4">
                <div class="form-group">
                  <label for="Category">Country Calling Code<small class="text-danger">*</small></label>
                  <ng-select id="countryCallingCode" class="ng-select-small" [(ngModel)]="countryCallingCode" 
                      placeholder="Select Country Calling Code">
                      <ng-option *ngFor="let item of countriesList" [value]="item.callingCode">{{item.callingCode}} {{item.name}}
                      </ng-option>
              </ng-select>
                </div>
                <div class ="alert alert-danger"  *ngIf="phoneNumber?.errors?.minlength">Phone Number is required</div>
              </div>
              <div class="col-sm-8">
                <div class="form-group">
                  <label for="Category">Phone Number<small class="text-danger">*</small></label>
                  <input ngModel #phoneNumber="ngModel" mask="(000)000-0000" [(ngModel)]="phoneNo" minlength="10" type="text" class="form-control form-control-sm"
                  id="medDose1" placeholder="Phone Number">
                </div>
                <div class ="alert alert-danger"  *ngIf="phoneNumber?.errors?.minlength">Phone Number is required</div>
              </div>
          </div>
            <div class="row">
              <div class="col-sm-12">
                <div class="form-group">
                  <label for="email">Email<small class="text-danger">*</small></label>
                  <input ngModel #fromEmail="ngModel" id="fromEmail" [(ngModel)]="email" minlength="1" maxlength="100" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,3}$" class="form-control form-control-sm" type="email" 
                   placeholder="Email" required>
                </div>
                <div class ="alert alert-danger"  *ngIf="fromEmail?.errors?.required">Email is required</div>
                <div  class ="alert alert-danger"  [hidden]="!fromEmail?.errors?.pattern">
              Email is not valid.
            </div>
              </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-dark btn-sm" aria-label="Close" (click)="editFacilityUserModal.hide();"
          mdbWavesEffect>Close</button>
        <button [disabled]="isUpdatingFacilityUser || !phoneNo || !email || !countryCallingCode || fromEmail?.errors?.required || fromEmail?.errors?.pattern || phoneNumber?.errors?.minlength" (click)="editFacilityUser()"  type="button" class="btn btn-dynamic-2c btn-sm" aria-label="Close"
          mdbWavesEffect>  <span *ngIf="isUpdatingFacilityUser" class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Update</button>
      </div>
    </div>
  </div>
</div>
