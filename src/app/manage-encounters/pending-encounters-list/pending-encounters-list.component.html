<div class="d-flex flex-row align-items-center justify-content-between mb-3">
  <div class="d-flex align-item-center justify-content-start">
    <h4 class="mr-3 mb-0"><a class="text-dark" (click)="navigateBack()">
        <i class="fa fa-arrow-left"></i></a></h4>
    <h1 class="page-title mb-0">Pending Encounters</h1>
  </div>

  <div>
    <!-- <a class="btn btn-dynamic-2c btn-sm px-3" (click)="addQuestion.show();editQuestion(row)">Assign</a> -->
    <!-- <div class="action-button">
      <a *ngIf="!isLoading" class="btn btn-dynamic-2c btn-sm" (click)="MakePDF();" title="export">
        <span *ngIf="isSpinner" class="spinner-border spinner-border-sm" role="status"
        aria-hidden="true"></span><i
          class="fa fa-print fa-lg"></i>Print</a>
      <a *ngIf="!isLoading" class="btn btn-dynamic-2c btn-sm" (click)="MakeExcel()" title="excel">Excel</a>
    </div> -->
  </div>
</div>
<!-- <div class="row mb-4">
  <div class="col-lg-4 col-sm-12">
    <div class="form-group">
      <label for="namea">Select Facility</label>
      <ng-select class="ng-select-small" [multiple]="false" [(ngModel)]="facilityId" (ngModelChange)="filterBills()"
        [searchable]="true" [loading]="LoadingData" placeholder="Filter By Facility">
        <ng-option [value]="0">All</ng-option>
        <ng-option *ngFor="let item of facilityList" [value]="item.id">{{item.facilityName}}
        </ng-option>
      </ng-select>
    </div>
  </div>
  <div class="col-lg-4 col-sm-12">
    <div class="form-group">
      <label for="namea">Select Month</label>
      <ng-select class="ng-select-small" [multiple]="false" [(ngModel)]="BillingMonth" (ngModelChange)="filterBills()"
        [searchable]="true" [loading]="LoadingData" placeholder="Filter By Month">
        <ng-option [value]="0">All</ng-option>
        <ng-option [value]="1">January</ng-option>
        <ng-option [value]="2">February</ng-option>
        <ng-option [value]="3">March</ng-option>
        <ng-option [value]="4">April</ng-option>
        <ng-option [value]="5">May</ng-option>
        <ng-option [value]="6">June</ng-option>
        <ng-option [value]="7">July</ng-option>
        <ng-option [value]="8">August</ng-option>
        <ng-option [value]="9">September</ng-option>
        <ng-option [value]="10">October</ng-option>
        <ng-option [value]="11">November</ng-option>
        <ng-option [value]="12">December</ng-option>
      </ng-select>
    </div>
  </div>
  <div class="col-lg-4 col-sm-12">
  </div>
</div> -->

<div class="d-flex align-items-center justify-content-between mb-3">
  <div class="col-lg col-sm px-0">
    <label for="searchBy">Search Patient</label>
    <div class="d-flex align-items-center justify-content-start">
      <input type="text" #searchPatient [(ngModel)]="filteredEncountersDto.searchParam" autocomplete="off"
        class="form-control form-control-sm box-shadow w-100" id="searchBy" placeholder="Name / EMR ID" />
        <button class="btn btn-dynamic-secondary-2c btn-sm mr-0 d-flex" (click)="GetPendingEncounterListExcelFile()"><span
          *ngIf="isExcelLoading" class="mr-1 spinner-border spinner-border-sm " role="status"
          aria-hidden="true"></span>Download</button>


        <button type="button" class="btn btn-dynamic-2c btn-sm my-0 flex-shrink-0 mr-0 px-sm-3 px-md-4 mr-0"
        appDebounceClick (debounceClick)="test.toggle()"><i class="fa fa-filter fa-lg"></i> Filter</button>

      </div>
    </div>
  </div>


<div class="search-filter collapseable" mdbCollapse #test="bs-collapse">
  <div class="panel" style="overflow: visible;">
    <div class="panel-header d-flex justify-content-between align-items-center">
      <h3>Search Filter</h3>
      <div>
        <button type="button" class="close pull-right" aria-label="Close" (click)="test.hide()">
          <span aria-hidden="true">Ã—</span>
        </button>
      </div>
    </div>
    <div class="panel-body">
      <div class="row">
        <div class="col-xl-3 col-lg-6 col-sm-6">
          <div class="form-group">
            <label class="w-100">Encounter Date</label>
            <input class="form-control form-control-sm box-shadow w-100" type="text" autocomplete="nope" name="daterangeInput"
              daterangepicker [(ngModel)]="selectedDateRange" [options]="options" (selected)="selectedDate($event, daterange)"
              placeholder="Date" (cancelDaterangepicker)="clearDate()" />
          </div>
        </div>
        <div class="col-xl-3 col-lg-6 col-sm-6">
          <div class="form-group">
            <label for="namee">Billing Provider</label>
            <ng-select class="ng-select-small" [loading]="isLoadingPayersList"
              [(ngModel)]="filteredEncountersDto.billingProviderId" [closeOnSelect]="true" [multiple]="false"
              [searchable]="true" placeholder="Billing Provider">
              <ng-option [value]="0">All</ng-option>
              <ng-option [value]="item.id" *ngFor="let item of (facilityUsersList | filterFUsersByRole: 'Billing Provider')">
                {{item.lastName}},{{item.firstName}} </ng-option>
            </ng-select>
          </div>
        </div>
        <div class="col-xl-3 col-lg-6 col-sm-6">
          <div class="form-group">
            <label for="namee">Assign To</label>
            <ng-select class="ng-select-small" [loading]="isLoadingPayersList"
              [(ngModel)]="filteredEncountersDto.assignedBillingProviderId" [closeOnSelect]="true" [multiple]="false"
              [searchable]="true" placeholder="Assign To">
              <ng-option [value]="0">All</ng-option>
              <ng-option [value]="item.id" *ngFor="let item of (facilityUsersList | filterFUsersByRole: 'Billing Provider')">
                {{item.lastName}},{{item.firstName}} </ng-option>
            </ng-select>
          </div>
        </div>
        <div class="col-xl-3 col-lg-6 col-sm-6">
          <div class="form-group">
            <label for="namee">Care Coordinator</label>
            <ng-select class="ng-select-small" [loading]="isLoadingPayersList"
              [(ngModel)]="filteredEncountersDto.careCoordinatorStaffId" [closeOnSelect]="true" [multiple]="false"
              [searchable]="true" placeholder="Care Coordinator">
              <ng-option [value]="0">All</ng-option>
              <ng-option [value]="item.id" *ngFor="let item of (facilityUsersList | filterFUsersByRole: 'Care Cordinator')">{{item.lastName}},{{item.firstName}} </ng-option>
            </ng-select>
          </div>
          <div class="d-flex justify-content-end align-items-center">

            <button type="button" class="btn btn-dynamic-2c btn-sm my-0 flex-shrink-0 mr-0 px-sm-3 px-md-4"
              (click)="GetPendingEncountersForSignature()">Apply</button>

          </div>

        </div>

      </div>
    </div>
  </div>
</div>



<!-- <mat-form-field class="show-rocord">
  Show Record
  <a [class.active]="PageSize===10" (click)="PageSize=10"
    class="link">10</a>
  <a [class.active]="PageSize===25" (click)="PageSize=25"
    class="link">25</a>
  <a [class.active]="PageSize===50" (click)="PageSize=50"
    class="link">50</a>
  <a [class.active]="PageSize===100" (click)="PageSize=100"
    class="link">100</a>
</mat-form-field> -->

<!-- <p><b>Facility Name:</b> {{facilityName}}</p> -->
<div class="dataTables_length" id="example_length"><label>Show
    <select name="example_length" aria-controls="example" [(ngModel)]="PageSize" class="">
      <option value="10">10</option>
      <option value="25">25</option>
      <option value="50">50</option>
      <option value="100">100</option>
    </select> entries</label>
</div>

<div class="ccm-header" style="position: relative;">
  <!-- <div class="ccm-nav" malihu-scrollbar [scrollbarOptions]="scrollbarOptionsTabs" style="min-width: 100%;"> -->
  <div class="ccm-nav d-flex flex-wrap align-items-center justify-content-between">
    <ul class="ccm-navbar">
      <li [class.active]="activeSec===1"><a (click)="activeSec=1;loadData('aWpendingEncounter')">Annual Wellness
          {{isLoading === false ? '('+ encountersObj.aWpendingEncounter?.length + ')' : ''}}</a></li>
      <li [class.active]="activeSec===2"><a (click)="activeSec=2;loadData('tcMpendingEncounter')">TCM
          {{isLoading === false ? '('+ encountersObj.tcMpendingEncounter?.length + ')' : ''}}</a></li>
      <li [class.active]="activeSec===3"><a (click)="activeSec=3;loadData('pendingDepressionScreening')">Depression
          {{isLoading === false ? '('+ encountersObj.pendingDepressionScreening?.length + ')' : ''}}</a></li>
      <li [class.active]="activeSec===4"><a (click)="activeSec=4;loadData('pendingAMScreening')">Alcohol
          {{isLoading === false ? '('+ encountersObj.pendingAMScreening?.length + ')' : ''}}</a></li>
      <li [class.active]="activeSec===5"><a (click)="activeSec=5;loadData('pendingCouncellings')">Counsellings
          {{isLoading === false ? '('+ encountersObj.pendingCouncellings?.length + ')' : ''}}</a></li>
    </ul>

    <div class="checkbox-container ml-auto p-2">

      <!-- Material inline 3 -->
      <div class="form-check form-check-inline">
        <input type="radio" [(ngModel)]="filteredEncountersDto.filterType" [value]="2"
          (change)="GetPendingEncountersForSignature()" class="form-check-input" id="materialInline3"
          name="inlineMaterialRadiosExample" mdbInput>
        <label class="form-check-label" for="materialInline3">Pending</label>
      </div>

      <!-- Material inline 2 -->
      <div class="form-check form-check-inline">
        <input type="radio" [(ngModel)]="filteredEncountersDto.filterType" [value]="1"
          (change)="GetPendingEncountersForSignature()" class="form-check-input" id="materialInline2"
          name="inlineMaterialRadiosExample" mdbInput>
        <label class="form-check-label" for="materialInline2">Successful</label>
      </div>

      <!-- Material inline 1 -->
      <div class="form-check form-check-inline">
        <input type="radio" [(ngModel)]="filteredEncountersDto.filterType" [value]="3"
          (change)="GetPendingEncountersForSignature()" class="form-check-input" id="materialInline1"
          name="inlineMaterialRadiosExample" mdbInput>
        <label class="form-check-label" for="materialInline1">All</label>
      </div>
    </div>
  </div>

</div>


<div *ngIf="isLoading" class="d-flex justify-content-center text-center">
  <mdb-progress-bar class="progress primary-color-dark mb-0" mode="indeterminate"></mdb-progress-bar>
</div>

<ngx-datatable *ngIf="pendingEncountersList" class="material" [columnMode]="'force'" [headerHeight]="50"
  [footerHeight]="50" [rowHeight]="40" [externalPaging]="false" [count]="pendingEncountersList?.length"
  [scrollbarV]="false" [scrollbarH]="true" [rows]="pendingEncountersList" [limit]="PageSize">
  <ngx-datatable-column name="#" [maxWidth]=50>
    <ng-template ngx-datatable-cell-template let-value="value" let-row="row" let-rowIndex="rowIndex">
      {{rowIndex + 1}}
    </ng-template>
  </ngx-datatable-column>
  <ngx-datatable-column name="Name" prop="patientName">
    <ng-template ngx-datatable-cell-template let-value="value" let-row="row" let-rowIndex="rowIndex">
      <div class="d-flex justify-content-between align-items-center">
        <!-- <small class="mr-3">{{(i + 1) + rowIndex}}</small> -->
        <span *ngIf="row.profileStatus" class="status-bullet bg-success" title="Profile Complete"></span>
        <span *ngIf="!row.profileStatus" class="status-bullet bg-danger" title="Profile Incomplete"></span>
        <a class="mb-0 text-capitalize link text-dynamic-2c text-left ml-2 mr-auto" placement="right" container="body"
          style="white-space: nowrap; height: 36px; display: inline-flex;margin-right:10px;
            align-items: center" (click)="onClickRow(row)">
          {{row.patientName}} </a>
      </div>
    </ng-template>
  </ngx-datatable-column>

  <ngx-datatable-column name="Type" prop="type">
  </ngx-datatable-column>
  <ngx-datatable-column name="Created On" prop="createdOn">
  </ngx-datatable-column>
  <ngx-datatable-column name="Assigned To" prop="assignedBillingProvider">
  </ngx-datatable-column>
  <ng-container *ngIf="activeSec == 1">

    <ngx-datatable-column name="Billing Provider" prop="billingProvider">
    </ngx-datatable-column>
    <ngx-datatable-column name="Care Coordinator" prop="careCoordinator">
    </ngx-datatable-column>
    <ngx-datatable-column name="Encounter Date" prop="encounterDate">
      <!-- <ng-template ngx-datatable-cell-template let-value="value" let-row="row" let-rowIndex="rowIndex">
          {{row.encounterDate | date}}
        </ng-template> -->
    </ngx-datatable-column>
  </ng-container>
  <!-- <ngx-datatable-column name="ICD-10 Codes">
      <ng-template ngx-datatable-cell-template let-value="value" let-row="row" let-rowIndex="rowIndex">
        <div *ngFor="let item of row.chronicDiseases">
          <small>{{item.detail}}</small>
          <br>
          <strong>{{item.algorithm}} </strong><small class="text-dynamic-2c"> {{item.icdCode}}</small>
        </div>
      </ng-template>
    </ngx-datatable-column> -->
  <!-- <ngx-datatable-column name="Time Completed" prop="timeCompleted">
    </ngx-datatable-column>
    <ngx-datatable-column name="Service Date" prop="serviceDate">
      <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
        {{row.serviceDate | date}}
      </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="Billing Provider" prop="billingProviderName">
    </ngx-datatable-column> -->
  <!-- <ngx-datatable-column name="Facility" prop="facilityName">
    </ngx-datatable-column> -->
  <ngx-datatable-column name="Action" [canAutoResize]=false [frozenRight]=true [width]="160">
    <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
      <div class="action-button">
        <a class="btn btn-dynamic-2c btn-icon" title="View" (click)="ProceedNavigation(row)" placement="left"><i
            class="fa fa-eye"></i> </a>
        <!-- <a  class="btn btn-dynamic-2c btn-icon" title="Edit" placement="left"><i class="fa fa-pencil"></i> </a> -->
        <!-- <a  class="btn btn-danger btn-icon" title="Remove" placement="left"><i class="fa fa-trash"></i></a> -->
      </div>
    </ng-template>
  </ngx-datatable-column>
  <!-- <ngx-datatable-column name="Action" [canAutoResize]=false [frozenRight]=true [width]="150">
        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
          <ng-select [searchable]="false" appendTo="body" placeholder="Yes" (click)="$event.stopPropagation();">
            <ng-option [value]="true">Yes</ng-option>
            <ng-option [value]="false">No</ng-option>
          </ng-select>
        </ng-template>
      </ngx-datatable-column> -->
</ngx-datatable>


<div mdbModal #clickOnRow="mdbModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myBasicModalLabel"
  aria-hidden="true">
  <div class="modal-dialog flat-modal" role="document">
    <div class="modal-content">
      <div class="modal-header">

        <h4 class="modal-title w-100 text-center" id="myModalLabel">Incomplete
          Profile
        </h4>
      </div>
      <div class="modal-body">
        <p class="text-center">
          <i class="fa fa-exclamation-triangle text-danger" style="font-size: 3rem;"></i>
        </p>

        <p class="text-center">
          Patient profile looks incomplete. <br> Would you like to edit patient profile?
        </p>

        <!-- Some required fields are missing.Please enter that data first. -->
        <div class="d-flex justify-content-center mt-3">
          <button type="button"  (click)="addRequiredData()" class="relative btn btn-sm btn-dynamic-2c"
            mdbWavesEffect>YES</button>
          <button type="button" class="btn btn-sm btn-dynamic-secondary-2c" aria-label="Close"
            (click)="clickOnRow.hide()">NO</button>

        </div>
      </div>

    </div>
  </div>
</div>
