<div class="d-flex align-items-center justify-content-between mb-3">
  <div class="d-flex align-items-center justify-content-between w-100">
    <!-- <h4 class="mr-3 mb-0"><a class="text-dark" (click)="navigateBack()"><i class="fa fa-arrow-left"></i></a></h4> -->
    <div class="d-flex">
      <h1 class="page-title mb-0 mr-2">Manage Inventory</h1>
      <div>
        <button  class="btn btn-dynamic-2c btn-icon my-0 mr-0" [mdbPopover]="template1" placement="left"
        mdbPopoverHeader="Transfer Device" triggers="focus">
          <span class="fa fa-question-circle fa-lg" ></span>
        </button>
        <!-- <button title="Issue Device" class="btn btn-dynamic-2c btn-icon mr-0"  [mdbPopover]="template2"  placement="bottom"
        mdbPopoverHeader="Issue Device" triggers="focus">
          <span class="fa fa-share fa-lg" ></span>
        </button>
        <button title="Return Device" class="btn btn-dynamic-2c btn-icon"  [mdbPopover]="template3"  placement="bottom"
          mdbPopoverHeader="Return Device" triggers="focus">
          <span class="fa fa-share fa-lg mr-0" style="transform: rotate( 180deg);"></span>
        </button>
        <button title="Device History" class="btn btn-dynamic-2c btn-icon"  [mdbPopover]="template4" placement="bottom"
          mdbPopoverHeader="Device History" triggers="focus">
          <i class="fa fa-history"></i>
        </button>
        <button title="Dispose Device" class="btn btn-danger btn-icon" [mdbPopover]="template5" placement="bottom"
          mdbPopoverHeader="Disposed " triggers="focus">
          <i class="fa fa-trash"></i>
        </button> -->
        <ng-template #template1>
          <div class="p-2">
            <p class="mb-1"><strong class="text-dynamic-2c">In Hand:</strong> List of the devices that are in possession of the facility and are not attached to any patient.</p>
            <p class="mb-1"><strong class="text-dynamic-2c">Issued:</strong> List of the devices that have been assigned to a patient from InHand Inventory.</p>
            <p class="mb-1"><strong class="text-dynamic-2c">Disposed:</strong> List of devices that are faulty, not in use, and not attached to any patient.</p>
            <p class="mb-1"><strong class="text-dynamic-2c">Transfer Device:</strong> This button is used to transfer devices from one facility to another.</p>
            <p class="mb-1"><strong class="text-dynamic-2c">Issue Device:</strong> This button is used to issue a device to any patient.</p>
            <p class="mb-1"><strong class="text-dynamic-2c">Move to Inhand:</strong> This button is used to move the device from the patient to the facility.</p>
            <p class="mb-1"><strong class="text-dynamic-2c">Device History:</strong> This button displays information about the device’s model number, serial number, the status of the device, action performed on the device, the date on which the action was performed, what action was performed, and who performed the actions(issuing, transferring & disposing of).</p>
            <p class="mb-1"><strong class="text-dynamic-2c">Device Sale Detail:</strong> This button shows the date, price, period, amount, and installments of the device.</p>
          </div>
        </ng-template>
      </div>
    </div>
    <div>
      <button class="btn btn-dynamic-2c btn-sm" (click)="OpenInventoryDetail({}, 'all')">ALL Devices</button>
    </div>

  </div>
  <div class="d-inline-flex">
    <div *hasClaim="['IsAppAdmin']">
      <ng-select [(ngModel)]="selectedFacility" [clearable]="false"  [searchable]="true"  class="ng-select-small" placeholder="Select Facility" style="min-width:200px" (change)="changeFacility($event)">
        <ng-option [value]="0">2C Inventory</ng-option>
        <ng-option [value]="facility.id" *ngFor="let facility of facilityList">{{facility.facilityName}}</ng-option>
      </ng-select>
    </div>

  </div>

</div>
<div class="row">
  <div class="col-lg-12 ">
    <!-- <p class="text-center" > -->
    <span class="alert alert-warning " *ngIf="false" role="alert">
      <strong> No Devices configured !</strong>
      <!-- No Data Found -->
    </span>
    <!-- </p> -->


    <div class="border-0">
      <div class="modality-info p-0">
        <div class="modality-list" >
          <div  class="item position-relative active my-2"
            >
            <div class="flex-1 d-flex align-items-center" style="margin: 0 10px;">
              <img src="/assets/rpm-devices/mbg.svg" style="width: 32px;"
                    alt="Blood Glucose">
              <p ><strong>Blood Glucose</strong></p>
            </div>
            <a  mdbTooltip="Modality Count"
              class="device device-active">{{deviceSummary.BGCount}}</a>
          </div>
        </div>
        <div class="modality-list" >
          <div  class="item position-relative active my-2"
            >
            <div class="flex-1 d-flex align-items-center" style="margin: 0 10px;">
              <img src="/assets/rpm-devices/mbp.svg" alt="Blood Pressure">
              <p ><strong>Blood Pressure</strong></p>
            </div>
            <a  mdbTooltip="Modality Count"
              class="device device-active">{{deviceSummary.BPCount}}</a>
          </div>
        </div>
        <div class="modality-list" >
          <div  class="item position-relative active my-2"
            >
            <div class="flex-1 d-flex align-items-center" style="margin: 0 10px;">
              <img src="/assets/rpm-devices/mw.svg" alt="Weight">
              <p ><strong>Weight</strong></p>
            </div>
            <a  mdbTooltip="Modality Count"
              class="device device-active">{{deviceSummary.WTCount}}</a>
          </div>
        </div>
        <div class="modality-list" >
          <div  class="item position-relative active my-2"
            >
            <div class="flex-1 d-flex align-items-center" style="margin: 0 10px;">
              <img src="/assets/rpm-devices/pulse.svg" alt="Pulse Oximetry">
              <p ><strong>Pulse Oximetry</strong></p>
            </div>
            <a  mdbTooltip="Modality Count"
              class="device device-active">{{deviceSummary.POCount}}</a>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
<div class="row d-flex">
  <div class="d-flex align-items-end col-lg-12 col-sm-12">
    <div class="flex-grow-1">
        <label for="searchBy">Search</label>
        <div class="d-flex align-items-center justify-content-start">
          <input type="text" [(ngModel)]="searchStr" #searchPatient  autocomplete="off" appOnDebounce [debounceTime]="1000"
          (onDebounce)="FilterDevices()"
          class="form-control form-control-sm box-shadow w-100" id="searchBy" placeholder="Search by Vendor & Device Name" />
        </div>
    </div>
    <ng-container *hasClaim="['IsAppAdmin']">
      <!-- <button *hasClaim="['CanModifyInventory']" routerLink="/rpm/order-inventory" [queryParams]="{tab: '1'}" type="button" class="btn btn-dynamic-2c btn-sm my-0 flex-shrink-0 mr-0">
          Add Order
      </button> -->
      <button *hasClaim="['CanModifyInventory']" [routerLink]="['/rpm/order-inventory']" [queryParams]="{tab: '2'}" type="button" class="btn btn-dynamic-2c btn-sm my-0 flex-shrink-0 mr-0">
          Add Inventory
      </button>
    </ng-container>
    <button [routerLink]="['/rpm-inventory/device-request']" type="button" class="btn btn-dynamic-2c btn-sm my-0 flex-shrink-0 mr-0">
        Device Requests
    </button>
    <!-- <button *hasClaim="['IsFacilityUser']" (click)="facilityDeviceRequestRef.OpenModal()" type="button" class="btn btn-dynamic-2c btn-sm my-0 flex-shrink-0 mr-0">
       Order Device
    </button> -->
  </div>
</div>

<div class="mt-3">
  <div *ngIf="gettingRPMInventry" class="d-flex justify-content-center text-center">
  <!-- <div class="d-flex justify-content-center text-center"> -->
  <mdb-progress-bar class="progress primary-color-dark mb-0" mode="indeterminate"></mdb-progress-bar>
</div>
  <ngx-datatable
    #myTable
    class="material fullscreen"
    [columnMode]="'force'"
    [headerHeight]="50"
    [footerHeight]="40"
    [rowHeight]="40"
    [scrollbarV]="false"
    [rows]="rows"
    [limit]="15"
    [offset]="0"
    [count]=""
    [loadingIndicator]=""
    [scrollbarH]="true">
      <ngx-datatable-column prop="vendorName" name="Vendor" >
      </ngx-datatable-column>
      <ngx-datatable-column prop="deviceName" name="Device Name" >
      </ngx-datatable-column>
      <ngx-datatable-column prop="total" name="Total" >
      </ngx-datatable-column>
      <ngx-datatable-column prop="inHand" name="In Hand" width="150" maxWidth="150" minWidth="150">
        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
          <div class="d-flex flex-nowrap align-items-center justify-content-between">
            <div class="user-name-list" (click)="OpenInventoryDetail(row , 'inhand')">
              <div class="name-caption rounded-hand"  title="Device Detail">
                <span>{{row.inHand}}</span>
              </div>
            </div>
            <!-- <button class="btn btn-dynamic-secondary-2c btn-sm">Details</button> -->
            <div>
              <ng-container *ngIf="selectedFacility!==0">
                <button *hasClaim="['CanModifyInventory']" (click)="OpenTransferDeviceModal(DeviceTransferCMPRef, row)" [disabled]="!row.inHand"  title="Transfer Device" class="btn btn-dynamic-2c btn-icon mr-0">
                  <i class="fa fa-exchange" style="margin-right: 4px;
                  margin-top: 6px;" ></i>
                 </button>
              </ng-container>
              <!-- <ng-container *ngIf="selectedFacility==0">
                <button title="Sale Device" class="btn btn-dynamic-2c btn-icon"
                (click)="OpenSaleDeviceModal(DeviceSaleRef, row)"><i class="fa fa-shopping-cart mr-0"></i></button>
              </ng-container> -->
              <ng-container *ngIf="!isAppAdmin">
                <button *hasClaim="['CanModifyInventory']" (click)="OpenIssueDeviceModal(DeviceIssueCMPRef, row)" [disabled]="!row.inHand" title="Issue Device" class="btn btn-dynamic-2c btn-icon">
                 <i class="fa fa-share" ></i>
                </button>
              </ng-container>
            </div>
          </div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column *ngIf="selectedFacility!=0" prop="inHand" name="Issued" width="150" maxWidth="150" minWidth="150">
        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
          <div class="d-flex flex-nowrap align-items-center justify-content-between pr-2">
            <div class="user-name-list" (click)="OpenInventoryDetail(row , 'issued')">
              <div class="name-caption rounded-hand" title="Device Detail">
                <span>{{row.issued}}</span>
              </div>
            </div>

            <!-- <button class="btn btn-dynamic-secondary-2c btn-sm">Details</button> -->
            <ng-container *ngIf="isFacilityUser">
              <div *hasClaim="['CanModifyInventory']">
                <button title="Move to Inhand" class="btn btn-dynamic-2c btn-icon"
                  (click)="OpenReturnDeviceModal(DeviceReturnCMPRef, row)"><i class="fa fa-share mr-0" style="transform: rotate( 180deg);"></i></button>
              </div>
            </ng-container>
          </div>
        </ng-template>
      </ngx-datatable-column>
      <ngx-datatable-column *hasClaim="['IsFacilityUser']" prop="inHand" name="Disposed" width="150" maxWidth="150" minWidth="150">
        <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>
          <div class="d-flex flex-nowrap align-items-center justify-content-between pr-2">
            <div class="user-name-list" (click)="OpenInventoryDetail(row , 'disposed')">
              <div class="name-caption rounded-hand" title="Device Detail">
                <span>{{row.disposed}}</span>
              </div>
            </div>
          </div>
        </ng-template>
      </ngx-datatable-column>
      <!-- <ngx-datatable-column prop="issued" name="Issued" >
      </ngx-datatable-column> -->
  </ngx-datatable>
</div>
<p>Total Devices: {{totalDevices}}</p>
<app-rpm-device-issue #DeviceIssueCMPRef (ReloadInventory)="GetRPMInventryList()"></app-rpm-device-issue>
<app-rpm-device-return #DeviceReturnCMPRef (ReloadInventory)="GetRPMInventryList()"></app-rpm-device-return>
<app-rpm-device-transfer #DeviceTransferCMPRef (ReloadInventory)="GetRPMInventryList()"></app-rpm-device-transfer>
<app-sale-device #DeviceSaleRef (ReloadInventory)="GetRPMInventryList()"></app-sale-device>
<app-rpm-device-dispose #DeviceDisposeCMPRef ></app-rpm-device-dispose>

<!-- <app-facility-device-request #facilityDeviceRequestRef></app-facility-device-request> -->
<!-- <div mdbModal #viewOrderDetailModal="mdbModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myviewOrderDetailModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Order Details</h5>
        <button type="button" class="close pull-right" aria-label="Close" (click)="viewOrderDetailModal.hide()">
          <span aria-hidden="true">×</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-4">
            <p><strong>Carrier: </strong>{{orderDetailObj?.order?.carrier}}</p>
          </div>
          <div class="col-md-4">
            <p><strong>Shipping Method: </strong>{{orderDetailObj?.order?.shipping_method}}</p>
          </div>
          <div class="col-md-4">
            <p><strong>Tracking No: </strong>{{orderDetailObj?.order?.tracking_number}}</p>
          </div>
          <div class="col-md-12">
            <p>{{orderDetailObj?.order?.notes || 'No Data'}}</p>
          </div>
          <div class="col-md-12">
            <p><strong>Note: </strong><span class="text-danger"> Last Updated: {{orderDetailObj?.order?.last_updated | date: 'medium'}}</span></p>
          </div>
        </div>
        <div class="table-responsive">
          <table class="table table-bordered">
            <thead class="bg-dynamic-2c text-white">
              <tr>
                <th>SKU</th>
                <th>Serial</th>
                <th>Lot</th>
                <th>Part No.</th>
                <th>UDC</th>
                <th>Qty</th>
                <th>Modal</th>
                <th>IMEI</th>
              </tr>
            </thead>
            <tbody>
              <tr >
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer ">
          <div *ngIf="orderDetailObj?.order">
            <span *ngIf="orderDetailObj?.order['oStatus'] == 'In Process'" style="min-width: 80px;" class="badge px-3 badge-primary m-0 mr-2">
              {{orderDetailObj?.order['oStatus']}}
            </span>
            <span *ngIf="orderDetailObj?.order['oStatus'] == 'Cancelled'" style="min-width: 80px;" class="badge px-3 badge-danger m-0 mr-2">
            {{orderDetailObj?.order['oStatus']}}
            </span>
          <span *ngIf="orderDetailObj?.order['oStatus'] == 'Closed'" style="min-width: 80px;" class="badge px-3 badge-warning m-0 mr-2">
            {{orderDetailObj?.order['oStatus']}}
          </span>
        </div>
          <button type="button" class="btn btn-dynamic-secondary-2c btn-sm m-0 " aria-label="Close" (click)="viewOrderDetailModal.hide()">
            Close
          </button>
      </div>
    </div>
  </div>
</div> -->

