<div class="d-flex align-items-center flex-wrap justify-content-between mb-3">
  <h4 class="mr-3 mb-0"><a class="text-dark" (click)="navigateBack()"><i
    class="fa fa-arrow-left"></i></a></h4>
  <h1 class="page-title mb-0 flex-sm-grow-1">Remote Patients</h1>

  <div *hasClaim="['CanViewCustomList']">
    <div class="dropdown" mdbDropdown [isDisabled]="(!selected || !selected.length)" *ngIf="CustomListDto && CustomListDto.length > 0">
      <button  mdbDropdownToggle mdbBtn  class="btn btn-dynamic-2c btn-sm mr-0" placement="right">Add to Custom List <i
          class="fa fa-angle-down ml-1"></i></button>
      <div class="dropdown-menu ">
        <a class="dropdown-item" *ngFor="let item of CustomListDto" (click)="$event.stopPropagation();AddPatientsToList(item.id)"><i
            class="fa fa-arrow-alt-circle-up fa-lg mr-1"></i>{{item.name}} </a>
      </div>
    </div>
  </div>

</div>

<div class="row d-flex form-group">
  <div class="col-lg-6 col-sm-6">
    <label for="searchBy">Search Patient</label>
    <div class="d-flex align-items-center justify-content-start">
      <input type="text" #searchPatient [(ngModel)]="filterPatientDto.searchParam" autocomplete="off"
        class="form-control form-control-sm box-shadow w-100" id="searchBy" placeholder="Name / EMR ID" />
    </div>
  </div>
  <div class="d-flex align-items-end col-lg-6 col-sm-6">
    <div class="flex-grow-1">
          <label for="practiceName">Select Care Provider</label>
          <ng-select class="ng-select-small"
            [(ngModel)]="filterPatientDto.careProviderId" (ngModelChange)="filterPatients();" [closeOnSelect]="true"
            [multiple]="false" [searchable]="true" placeholder="Select Care Provider">
            <ng-option [value]="0">All</ng-option>
            <ng-option *ngFor="let item of CareProvidersList" [value]="item.id">{{item.lastName}},{{item.firstName}}
            </ng-option>
          </ng-select>
      </div>
      <div>
        <button appDebounceClick (debounceClick)="careGap.toggle()" type="button"
        class="btn btn-dynamic-2c btn-sm my-0 flex-shrink-0 mr-0">
        <i class="fa fa-filter fa-lg"></i> Filter
        </button>
        <button type="button" (click)="resetFilter(); filterPatients()"
        class="btn btn-dynamic-secondary-2c btn-sm mr-0 flex-shrink-0">
        <i class="fa fa-refresh fa-lg"></i> Reset
      </button>
      </div>

  </div>
</div>


<div class="search-filter collapseable" mdbCollapse #careGap="bs-collapse">
  <div class="panel" style="overflow: visible;">
    <div class="panel-header d-flex justify-content-between align-items-center">
      <h3>Search Filter</h3>
      <div>
        <button type="button" class="close pull-right" aria-label="Close" (click)="careGap.toggle()">
          <span aria-hidden="true">Ã—</span>
        </button>
      </div>
    </div>
    <div class="panel-body">
      <div class="row">
        <div class="col-xl-6 col-lg-6 col-sm-6">
          <div class="form-group">
            <label for="rpmStatus">RPM Status<small class="text-danger"></small></label>
            <ng-select [(ngModel)]="filterPatientDto.rpmStatus" id="rpmStatus" appendTo="body" [searchable]="false"
            [closeOnSelect]="true" class="ng-select-small" placeholder="Rpm Status">
            <ng-option [value]="-1">All</ng-option>
            <ng-option [value]="0">Active</ng-option>
            <ng-option [value]="1">Not Started</ng-option>
            <ng-option [value]="2">Not Eligible</ng-option>
            <ng-option [value]="3">Identified</ng-option>
          </ng-select>
          </div>
        </div>
        <!-- <div class="col-xl-6 col-lg-6 col-sm-6">
          <div class="form-group">
            <label for="rpmStatus">RPM Manager Name<small class="text-danger"></small></label>
            <ng-select class="ng-select-small" [loading]="isLoadingPayersList" id="rpmStatus"
            [multiple]="false" [searchable]="true"
              placeholder="RPM Manager Name">
              <ng-option [value]="0">All</ng-option>
              <ng-option *ngFor="let item of psyfacilityUserList" [value]="item.id">{{ item.firstName }}
                {{ item.lastName }}
              </ng-option>
            </ng-select>
          </div>
        </div> -->
        <div class="col-lg-6 col-sm-6">
          <div class="form-group mb-0">
            <label class="w-100">Last Reading Date</label>
           <input type="text" class="form-control form-control-sm" name="daterangeInput" daterangepicker [(ngModel)]="selectedDateRange"
               [options]="options" (selected)="selectedDate($event, daterange)" (cancelDaterangepicker)="clearDate()" />
          </div>
        </div>
        <div class="col-lg-6 col-sm-6">
          <div class="form-group mb-0">
            <label class="w-100">Last Log Date</label>
               <input type="text" class="form-control form-control-sm" name="daterangeInput1" daterangepicker [(ngModel)]="selectedDateRange1"
               [options]="options" (selected)="selectedDate1($event, daterange)" (cancelDaterangepicker)="clearDate2()"/>
          </div>
        </div>
      </div>
      <div class="d-flex justify-content-end mt-2">
        <div class="btn-group">
          <button type="button" (click)="filterPatients(); scrollToTable();"
            class="btn btn-dynamic-2c btn-sm mx-0 flex-shrink-0">
            <i class="fa fa-filter fa-lg"></i> Search
          </button>

        </div>
      </div>
    </div>
  </div>
</div>



<div class="position-relative patients-list">
  <div *hasClaim="['CanViewCustomList']" class="col-xl-6 col-lg-6 col-sm-12 custom-list-dropdown px-0">
    <div class="d-flex align-items-center"  *ngIf="CustomListDto && CustomListDto.length > 0">
      <label for="name">Apply Custom List</label>
      <ng-select [(ngModel)]="filterPatientDto.customListId" [searchable]="false" [closeOnSelect]="true"
        (ngModelChange)="filterPatients()" class="flex-grow-1 ml-3 ng-select-small" placeholder="Custom Lists"
        [ngClass]="{'my-class': filterPatientDto.customListId > 0}">
        <ng-option [value]="0">Select Custom List</ng-option>
        <ng-option [value]="item.id" *ngFor="let item of CustomListDto">{{item.name}} </ng-option>
      </ng-select>
    </div>
  </div>
  <div appCcmLoader>
    <div class="loader-wrap" *ngIf="loadingOnStart">
      <div class="text-dynamic-2c la-ball-pulse ccm-loader">
        <div></div>
        <div></div>
        <div></div>
      </div>
    </div>
  </div>
  <!-- <div class="position-absolute" style="right: 0;">
    <mdb-checkbox [default]="true" [(ngModel)]="filterPatientDto.showAll" (change)="filterPatients()">Show All
    </mdb-checkbox>
  </div> -->
  <div *ngIf="isLoading" class="d-flex justify-content-center text-center loadingrow">
    <mdb-progress-bar class="progress primary-color-dark mb-0" mode="indeterminate"></mdb-progress-bar>
  </div>
  <table datatable [dtOptions]="dtOptions" id="example" [dtTrigger]="dtTrigger"
    class="cell-border hover text-nowrap ccm-datatable">
    <thead>
      <tr>
        <th>ID</th>
        <th>
          <span style="white-space: nowrap; display: block;">Name</span>
        </th>
        <th>
          <div class="text-center">
          <div class="custom-control custom-checkbox">
            <input class="custom-control-input" type="checkbox" id="selectAll" [(ngModel)]="gridCheckAll"
              (change)="gridAllRowsCheckBoxChecked($event)">
            <label class="custom-control-label" for="selectAll"></label>
          </div>
          </div>
        </th>
        <th>RPM Status</th>
        <th>Last Reading Date</th>
        <th>Last Log Date</th>
        <th>Rpm Manager</th>
        <th>CP Name</th>
        <!-- <th>Action</th> -->
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let row of rows; let i = index">
        <!-- (click)="row.checked = !row.checked; selectRow(row)" -->
        <td>
          <small class="mr-3">{{ i + 1 + rowIndex }}</small>
        </td>
        <td>
          <div class="d-flex justify-content-between align-items-center">
            <!-- <small class="mr-3">{{(i + 1) + rowIndex}}</small> -->
            <a class="mb-0 text-capitalize link text-dynamic-2c text-left ml-2" placement="right" container="body" [mdbTooltip]="popTemplate"
              style="white-space: nowrap; height: 36px; display: inline-flex;margin-right:10px;
              align-items: center" (click)="onClickRow(row, $event)">
              {{row.fullName}} </a>

            <ng-template #popTemplate>
              <div class="p-2">
                <p class="mb-0"><strong>DOB</strong> {{row.dateOfBirth | dateFormatPipe}} </p>
                <p class="mb-0"><strong>EMR ID:</strong> {{row.patientEmrId}} </p>
              </div>

            </ng-template>
            <div class="action-button d-flex justify-content-center">
              <button (click)="goLogs(row)" title="logs History" class="btn btn-dynamic-2c btn-icon my-1"
                ><i class="fa fa-history"></i>
              </button>
              <button routerLink="/rpm/patients/{{row.id}}/readings" title="Readings"
                class="btn btn-dynamic-2c btn-icon my-1 ml-0" >
                <i class="fa fa-eye"></i>
              </button>
              <button routerLink="/alertManager/alertList/{{row.id}}" title="Rpm Alerts"
                class="btn btn-dynamic-2c btn-icon my-1 ml-0" >
                <i class="fa fa-exclamation-triangle"></i>
              </button>
            </div>

          </div>
          <!-- {{ row.fullName }} -->
          <!-- <div class="d-flex justify-content-between align-items-center">
            <a class="mb-0 text-capitalize link text-dynamic-2c text-left ml-2" style="white-space: nowrap; width: 200px;"
              (click)="onClickRow(row)">
              {{ row.fullName }}</a>
          </div> -->
        </td>
        <td>
          <div class="text-center">
            <div class="custom-control custom-checkbox">
              <input class="custom-control-input" type="checkbox" id="{{(i + 1) + rowIndex}}" [(ngModel)]="row.checked"
                (click)="rowCheckBoxChecked($event, row)">
              <label class="custom-control-label" for="{{(i + 1) + rowIndex}}"></label>
            </div>
          </div>
        </td>
        <td>
         {{rpmStatusEnum[row.rpmStatus]}}
          <!-- {{ row.psychiatristName }} -->
        </td>
        <td>
          <span *ngIf="row.lastReadingDate != '0001-01-01T00:00:00'">

            {{row.lastReadingDate | dateFormatPipe}}
          </span>
        </td>
        <td>
          <span *ngIf="row.lastLogDate != '0001-01-01T00:00:00'">
            {{row.lastLogDate | dateFormatPipe}}
          </span>
        </td>


        <td>
          <div class="user-name-list">
            <div title="{{item.fullName}}" class="name-caption" *ngFor="let item of row.careProviders">
              <span>{{item['nameAbbreviation']}}</span></div>
          </div>
          <!-- {{row.careProviderNames}} -->
          <!-- <div class="user-name-list" *ngIf="row.careFacilitatorNameAbbreviation">
            <div title="{{row.careFacilitatorName}}" class="name-caption">
              <span>{{row.careFacilitatorNameAbbreviation}}</span></div>
          </div> -->
        </td>

        <td style="width:120px">

        </td>
      </tr>
    </tbody>
    <!-- <tbody *ngIf="rows.length === 0">
      <td class="bg-white p-3 text-danger" colspan="12">No Record Found</td>
     </tbody> -->
  </table>
</div>

<div mdbModal #clickOnRow="mdbModal" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myBasicModalLabel"
  aria-hidden="true">
  <div class="modal-dialog flat-modal" role="document">
    <div class="modal-content">
      <div class="modal-header">

        <h4 class="modal-title w-100 text-center" id="myModalLabel">Incomplete
          Profile
        </h4>
      </div>
      <div class="modal-body">
        <p class="text-center">
          <i class="fa fa-exclamation-triangle text-danger" style="font-size: 3rem;"></i>
        </p>

        <p class="text-center">
          Patient profile looks incomplete. <br> Would you like to edit patient profile?
        </p>

        <!-- Some required fields are missing.Please enter that data first. -->
        <div class="d-flex justify-content-center mt-3">
          <button type="button" (click)="addRequiredData()" class="relative btn btn-sm btn-dynamic-2c"
            mdbWavesEffect>YES</button>
          <button type="button" class="btn btn-sm btn-dynamic-secondary-2c" aria-label="Close"
            (click)="clickOnRow.hide()">NO</button>

        </div>
      </div>

    </div>
  </div>
</div>
