<div class="d-flex flex-row align-items-center justify-content-between mb-3">
  <div class="d-flex justify-content-start align-items-center">
    <h4 class="mr-3 mb-0"><a class="text-dark" (click)="goBack()">
        <i class="fa fa-arrow-left"></i></a></h4>
    <h1 class="page-title mb-0">PCM</h1>
  </div>
  <app-patient-gap-detail></app-patient-gap-detail>
  <!-- <div> -->
    <!-- <div class="action-button">
      <div class="btn-group" mdbDropdown>
        <a mdbDropdownToggle class="btn btn-dynamic-2c btn-icon" placement="left"><i class="fa fa-plus"></i></a>
        <div class="dropdown-menu dropdown-menu-right status-dropdown">
          <div>
            <button [disabled]="isCreatingScreening" (click)="$event.stopPropagation();AddAMScreening()" class="dropdown-item">AM Screening <span *ngIf="isCreatingScreening" class="spinner-border spinner-border-sm" role="status"
              aria-hidden="true"></span></button>
              <button [disabled]="isCreatingAMCounselling" (click)="$event.stopPropagation();counselling= 'AM';AddEditCounseling()" class="dropdown-item">AM Counselling <span *ngIf="isCreatingAMCounselling" class="spinner-border spinner-border-sm" role="status"
                aria-hidden="true"></span></button>
            <button [disabled]="isCreatingDPScreening" (click)="$event.stopPropagation();AddDepressionScreening()" class="dropdown-item">DP Screening <span *ngIf="isCreatingDPScreening" class="spinner-border spinner-border-sm" role="status"
              aria-hidden="true"></span></button>
            <button [disabled]="isCreatingDPCounselling" (click)="$event.stopPropagation();counselling= 'DP';AddEditCounseling()" class="dropdown-item">DP Counselling <span *ngIf="isCreatingDPCounselling" class="spinner-border spinner-border-sm" role="status"
              aria-hidden="true"></span></button>
          </div>

        </div>
      </div>
    </div> -->
  <!-- </div> -->
</div>
<app-patient-details></app-patient-details>

<mdb-tabset #tutorTabs [buttonClass]="'classic-tabs classic-tabs-mh  tabs-outline-primary tabs-2'" [contentClass]="'tab-shadow border'"
  class="classic-tabs classic-tabs-mh mt-3 row tabs-outline-primary">

  <mdb-tab heading="PCM Measures">
    <ngx-datatable #table class="material" [columnMode]="'force'" [headerHeight]="50" [footerHeight]="50" [rowHeight]="40"
    [scrollbarV]="false" [scrollbarH]="true" [rows]="pcmMeasuresList" [offset]="0">
    <ngx-datatable-column name="#" [width]=50>
      <ng-template ngx-datatable-cell-template let-value="value" let-row="row" let-rowIndex="rowIndex">
        <small class="mr-3">{{(rowIndex + 1)}}</small>
      </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="Measure Name " [width]=300 class="name-cell" style="width:300px;min-width: 300px;max-width: 300px;" >
      <ng-template ngx-datatable-cell-template class="abcd" let-value="value" let-row="row" let-rowIndex="rowIndex">
        <div class="d-flex justify-content-between align-items-center">
          <div class="mb-0 text-uppercase link text-dynamic-2c text-left ml-2"
                style=" width: 260px;min-width:260px; font-size:10px;white-space: normal;" title="{{row.measureName}}">
                {{row.measureName}}
          </div>
          <div (appIsOutside)="pop.isOpen=false">
            <button id="popTemplate{{rowIndex}}" style="background-color: transparent;" class="p-0 border-0"  #pop="bs-mdbPopover" triggers="focus" [mdbPopover]="popTemplate" placement="right"><i
                class="fa fa-exclamation-circle fa-lg "></i></button>
            <ng-template #popTemplate>
              <div class="bg-dark text-white py-1 pl-3 pr-3">

                <div class="who-covered" style="max-height:300px;">
                  <div style="max-height: 200px;overflow-y:auto;" malihu-scrollbar
                    [scrollbarOptions]="scrollbarOptionsTimeline">{{row.note}}</div>
                </div>
              </div>
            </ng-template>
          </div>

          <!-- <button type="button" class="btn btn-icon btn-dynamic-2c ml-0"
          (click)="selectedMeasure=row;gapModelOpenFromOtherComponent(row.code, pcmMOdel);"><i class="fa fa-eye"></i></button> -->
        </div>
      </ng-template>

    </ngx-datatable-column>
    <ngx-datatable-column name="Status">
      <ng-template ngx-datatable-cell-template class="text-center" let-value="value" let-row="row" let-rowIndex="rowIndex">
        <span style="min-width: 80px;" class="badge status status-{{row.color}}">{{ row.cStatus }}</span>
      </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="Last Done">
      <ng-template ngx-datatable-cell-template let-value="value" let-row="row" let-rowIndex="rowIndex">
        {{ row.lastDone | dateFormatPipe }}
      </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="Next Due" prop="nextDue">
      <ng-template ngx-datatable-cell-template let-value="value" let-row="row" let-rowIndex="rowIndex">
        {{ row.nextDue | dateFormatPipe }}
      </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="Result" prop="result"> </ngx-datatable-column>
    <!-- <ngx-datatable-column name="Dependency Score" prop="dependenceScore"> </ngx-datatable-column> -->
    <!-- <ngx-datatable-column name="Encounter Type" prop="encounterType"> </ngx-datatable-column>
    <ngx-datatable-column name="Result" prop="result"> </ngx-datatable-column> -->
    <!-- <ngx-datatable-column name="Note" prop="note"> </ngx-datatable-column> -->

    <ngx-datatable-column name="Action" >
      <ng-template let-row="row" let-value="value" ngx-datatable-cell-template>

        <button type="button" class="btn btn-icon btn-dynamic-2c ml-0"
          (click)="selectedMeasure=row;gapModelOpenFromOtherComponent(row.code);"><i class="fa fa-eye fa-lg"></i></button>

      </ng-template>
    </ngx-datatable-column>
    <!-- <ngx-datatable-column name="action" prop="Notes"> </ngx-datatable-column> -->
  </ngx-datatable>
  </mdb-tab>

  <mdb-tab heading="Preventive Care">
    <app-pcm-encounter-list></app-pcm-encounter-list>
  </mdb-tab>
</mdb-tabset>






<div mdbModal (close)="selectedMeasure={}" #pcmMOdel="mdbModal" class="modal fade" tabindex="-1" role="dialog"
  aria-labelledby="mypcmMOdelLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable" role="document">
    <div class="modal-content">
      <div class="modal-header py-2">
        <button type="button" class="close pull-right" aria-label="Close" (click)="pcmMOdel.hide()">
          <span aria-hidden="true">Ã—</span>
        </button>

        <div class="d-flex align-items-center">
          <ng-container *ngIf="selectedMeasure && selectedMeasure.measureName">
            <h4 class="modal-title w-100" title="{{selectedMeasure.measureName}}">
              {{selectedMeasure.measureName | ellipsis:30 }} </h4>
          </ng-container>
          <!-- <a id="popTemplate" class="ml-3" container="body" [mdbPopover]="popTemplate" placement="bottom"
            triggers="focus"><i class="fa fa-exclamation-circle fa-lg"></i></a> -->
            <a id="popTemplate" #popupInfo="bs-mdbPopover" class="ml-3" container="body" [mdbPopover]="popTemplate" placement="bottom" (click)="popupQustion ? popupQustion.hide(): ''"
            triggers="focus"><i class="fa fa-exclamation-circle fa-lg"></i></a>

            <a id="popTemplateTwo"  #popupQustion="bs-mdbPopover" *ngIf="pcmMOdelData.guideline" class="ml-3" container="body" [mdbPopover]="popTemplateTwo" (click)="popupInfo.hide();" placement="bottom"
            triggers="focus"><i class="fa  fa-question-circle fa-lg"></i></a>

          <ng-template #popTemplate>
            <div class="bg-dark text-white py-3 pl-3 pr-2">
              <div class="who-covered" (click)="$event.stopPropagation()" [innerHTML]="whoIsCovered" malihu-scrollbar
                [scrollbarOptions]="scrollbarOptionsTimeline" style="max-height: 300px;"></div>
            </div>
          </ng-template>
          <ng-template #popTemplateTwo>
            <div class="bg-dark text-white py-3 pl-2 pr-2">
              <div class="who-covered" (click)="$event.stopPropagation()" [innerHTML]="pcmMOdelData.guideline"  malihu-scrollbar
                [scrollbarOptions]="scrollbarOptionsTimeline" style="max-height: 300px;">
              </div>
            </div>
          </ng-template>

        </div>

      </div>
      <div class="modal-body">
        <skltn-root *ngIf="pcmModelLoading" duration="2000" [rectRadius]="0" flareWidth="50%" bgFill="#f2f3f8"
          flareFill="rgba(255,255,255, 0.5)">
          <!-- Card with Avatar -->
          <div class="skltn-card">
            <div skltn-bone class="skltn-card__avatar" type="circle"></div>
            <div class="skltn-card__body">
              <div skltn-bone class="skltn-card__title"></div>
              <div skltn-bone class="skltn-card__line"></div>
              <div skltn-bone class="skltn-card__line"></div>
            </div>
          </div>
        </skltn-root>
        <ng-container *ngIf="!pcmModelLoading">
          <div class="d-flex align-items-center justify-content-between mb-2">
            <div class="d-flex align-items-center">
              <p class="m-0">Status:</p>
              <div class="ml-3 dropdown" *ngIf="selectedGapStatus" mdbDropdown>
                <mdb-badge mdbDropdownToggle success="true">{{selectedGapStatus.name}}</mdb-badge>

                <div class="dropdown-menu">
                    <!-- <span [ngStyle]="{'backgroupcmMOdelDatand': item.color}"></span> -->
                    <a [class.active]="pcmMOdelData.currentStatus===item.value"
                      (click)="pcmMOdelData.currentStatus=item.value;selectedGapStatus=item;"
                      *ngFor="let item of pcmMOdelData.statusList" class="dropdown-item">{{item.name}}</a>

                </div>
              </div>
            </div>
            <div class="btn-group ml-3" >
              <div>
                <div class="custom-control custom-checkbox custom-control-inline">
                  <input type="checkbox" [(ngModel)]="pcmMOdelData.controlled" class="custom-control-input" id="Controlled232"
                    name="Controlleds">
                  <label class="custom-control-label" for="Controlled232">Controlled</label>
                </div>
              </div>
          </div>
            <!-- <div class="btn-group ml-3" *ngIf="pcmMOdelData.hasEncounters" mdbDropdown>
              <a mdbDropdownToggle class="btn btn-dynamic-2c btn-icon" placement="left"><i class="fa fa-plus"></i></a>
              <div class="dropdown-menu dropdown-menu-right status-dropdown">
                <div>
                  <button *ngIf="selectedMeasure.code !== 'AW'" [disabled]="isCreatingScreening" (click)="$event.stopPropagation();AddScreening()" class="dropdown-item">{{selectedMeasure.code}} Screening <span *ngIf="isCreatingScreening" class="spinner-border spinner-border-sm" role="status"
                    aria-hidden="true"></span></button>
                  <button *ngIf="selectedMeasure.code !== 'AW'" [disabled]="isCreatingCounselling" (click)="$event.stopPropagation();AddCounselling()" class="dropdown-item">{{selectedMeasure.code}} Counselling <span *ngIf="isCreatingCounselling" class="spinner-border spinner-border-sm" role="status"
                    aria-hidden="true"></span></button>
                  <button *ngIf="selectedMeasure.code === 'AW'" [disabled]="isCreatingAWEncounter" (click)="$event.stopPropagation();AddAWEncounter()" class="dropdown-item">Add Encounter <span *ngIf="isCreatingAWEncounter" class="spinner-border spinner-border-sm" role="status"
                    aria-hidden="true"></span></button>
                </div>

              </div>
            </div> -->
          </div>
          <div class="border p-3 mb-3">
            <!-- <p class="mb-3"><label> Reference Link: </label> <a>Demo Link</a></p> -->
            <div class="input-group form-group">
              <label style="width: 70px;" class="flex-shrink-0">Last Done</label>
              <input type="text" class="form-control form-control-sm ml-3" [(ngModel)]="pcmMOdelData.lastDone"
                #date="dpDayPicker" [dpDayPicker]="datePickerConfig" [theme]="'dp-material ccm-date-picker'"
                [mode]="'day'" />
              <a (click)="date.api.open();" class="input-group-append">
                <span class="input-group-text text-white bg-dynamic-2c" id="category1"><i
                    class="fa fa-calendar fa-lg"></i></span> </a>
            </div>
            <div class="d-flex">
              <label style="width: 70px;" class="flex-shrink-0" for="result" s>Result</label>
              <div class="form-group flex-1 ml-3">
                <input [(ngModel)]="pcmMOdelData.result" type="text" class="form-control" id="result"
                  placeholder="Risk Level">
              </div>
            </div>
            <div class="form-form form-group d-flex mb-0">
              <label style="width: 70px;" class="flex-shrink-0" for="note">Notes</label>
              <textarea [(ngModel)]="pcmMOdelData.note" type="text" id="note" style="height:100px" rows="6"
                class="form-control ml-3"></textarea>
            </div>
          </div>

          <div class="border p-3">
            <div class="input-group form-group">
              <label style="width: 70px;" class="flex-shrink-0 ">Next Due</label>
              <input [(ngModel)]="pcmMOdelData.nextDue" type="text" class="form-control form-control-sm ml-3"
                #dateDPicker="dpDayPicker" [dpDayPicker]="datePickerConfig" [theme]="'dp-material ccm-date-picker'"
                [mode]="'day'" />
              <a (click)="dateDPicker.api.open();" class="input-group-append">
                <span class="input-group-text text-white bg-dynamic-2c" id="category"><i
                    class="fa fa-calendar fa-lg"></i></span> </a>
            </div>
            <div class="d-flex align-items-start">
              <label for="file" class="flex-shrink-0" style="width: 70px;">Attachment</label>
              <div class="file-field flex-wrap align-items-center w-100 ml-3">
                <div class="btn btn-success btn-sm mx-0 mt-0">
                  <span class="w-100"><i class="fa fa-paperclip fa-lg"></i> Attach File 111<span
                      *ngIf="uploadImg" class="mr-1 spinner-border spinner-border-sm" role="status"
                      aria-hidden="true"></span></span>
                  <input type="file" mdbFileSelect accept=".pdf, .xlsx,.docx, .doc, .odt , .txt, .ppt, .pptx"
                    (change)="onUploadOutput($event);" #select>
                </div>
              </div>
            </div>
            <div class="w-100" *ngIf="pcmMOdelData.pcmDocuments && pcmMOdelData.pcmDocuments.length > 0">
              <div class="file-field flex-wrap align-items-center">
                <div *ngFor="let doc of pcmMOdelData.pcmDocuments" class="file-item">
                  <small class="mb-0">{{doc.title | slice:0:40}}<a (click)="DeleteDoc(doc)"><i
                        class="ml-2 fa fa-times fa-lg text-danger"></i>
                    </a></small>
                </div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>
      <div class="modal-footer">
        <button type="button" class="waves-light btn btn-sm btn-dynamic-secondary-2c" aria-label="Close"
          (click)="pcmMOdel.hide()" mdbWavesEffect>Cancel</button>
        <button [disabled]="editingPcmData" type="button" (click)="AddEditMeasureData(pcmMOdel)"
           class="relative waves-light btn btn-sm btn-dynamic-2c" mdbWavesEffect><span *ngIf="editingPcmData"
            class="mr-1 spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Update</button>
      </div>
    </div>
  </div>
</div>
